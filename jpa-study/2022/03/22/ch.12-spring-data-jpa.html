<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>[자바 ORM 표준 JPA 프로그래밍] 12장. 스프링 데이터 JPA</title>
  <meta name="description" content="12장. 스프링 데이터 JPA">
  
  <meta name="author" content="Jo">
  <meta name="copyright" content="&copy; Jo 2022">
  

  <!-- External libraries -->
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css">
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/styles/monokai-sublime.min.css">
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/lightbox2/2.7.1/css/lightbox.css">

  <!-- Favicon and other icons (made with http://www.favicon-generator.org/) -->
  <link rel="shortcut icon" href="/assets/icons/favicon.ico" type="image/x-icon">
  <link rel="icon" href="/assets/icons/favicon.ico" type="image/x-icon">
  <link rel="apple-touch-icon" sizes="57x57" href="/assets/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/assets/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/assets/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/assets/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/assets/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/assets/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/assets/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/assets/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/assets/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192"  href="/assets/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/assets/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/assets/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/assets/icons/favicon-16x16.png">
  <link rel="manifest" href="/assets/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/assets/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">

  
  <!-- Facebook OGP cards -->
  <meta property="og:description" content="12장. 스프링 데이터 JPA" />
  <meta property="og:url" content="https://sungunjo.github.io/jpa-study/2022/03/22/ch.12-spring-data-jpa.html">
  <meta property="og:site_name" content="Development Stash" />
  <meta property="og:title" content="[자바 ORM 표준 JPA 프로그래밍] 12장. 스프링 데이터 JPA" />
  <meta property="og:type" content="website" />
  <meta property="og:image" content="https://sungunjo.github.io/assets/instacode.png" />
  <meta property="og:image:type" content="image/png" />
  <meta property="og:image:width" content="612" />
  <meta property="og:image:height" content="605" />
  

  
  <!-- Twitter: card tags -->
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="[자바 ORM 표준 JPA 프로그래밍] 12장. 스프링 데이터 JPA">
  <meta name="twitter:description" content="12장. 스프링 데이터 JPA">
  <meta name="twitter:image" content="https://sungunjo.github.io/assets/instacode.png">
  <meta name="twitter:url" content="https://sungunjo.github.io/jpa-study/2022/03/22/ch.12-spring-data-jpa.html">
  

  

  <!-- Site styles -->
  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="https://sungunjo.github.io/jpa-study/2022/03/22/ch.12-spring-data-jpa.html">
	<link rel="alternate" type="application/rss+xml" title="Development Stash" href="https://sungunjo.github.io/feed.xml" />
	
	<!-- Tooltips -->
	<script type="text/javascript">
		window.tooltips = []
	</script>
</head>


  <body>

    <header class="navigation" role="banner">
  <div class="navigation-wrapper">
    <a href="/" class="logo">
      
      <img src="/assets/logo.png" alt="Development Stash">
      
    </a>
    <a href="javascript:void(0)" class="navigation-menu-button" id="js-mobile-menu">
      <i class="fa fa-bars"></i>
    </a>
    <nav role="navigation">
      <ul id="js-navigation-menu" class="navigation-menu show">
				
	
	<li class="nav-link"><a href="/about/">About</a>
	

	

	

	
	<li class="nav-link"><a href="/posts/">Posts</a>
	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	


      </ul>
    </nav>
  </div>
</header>


    <div class="page-content">
        <div class="post">

<div class="post-header-container has-cover" style="background-image: url(/assets/instacode.png);">
  <div class="scrim has-cover">
    <header class="post-header">
      <h1 class="title">[자바 ORM 표준 JPA 프로그래밍] 12장. 스프링 데이터 JPA</h1>
      <p class="info">by <strong>Jo</strong></p>
    </header>
  </div>
</div>

<div class="wrapper">



<section class="post-meta">
  <div class="post-date">March 22, 2022</div>
  <div class="post-categories">
  in 
    
    <a href="/category/jpa-study">Jpa-study</a>
    
  
  </div>
</section>

<article class="post-content">
  <h1 id="12장-스프링-데이터-jpa">12장. 스프링 데이터 JPA</h1>

<p><br /></p>

<h1 id="121-스프링-데이터-jpa-소개">12.1 스프링 데이터 JPA 소개</h1>
<ul>
  <li>CRUD 처리를 위한 공통 인터페이스 제공</li>
  <li>리포지토리 개발 시 인터페이스만 작성하면 실행 시점에 구현 객체를 동적으로 생성, 주입
    <ul>
      <li>데이터 접근 계층 개발 시 구현 클래스 없이 인터페이스만 작성해도 됨</li>
    </ul>
  </li>
</ul>

<p><br />
<br />
<br /></p>

<h1 id="122-스프링-데이터-jpa-설정">12.2 스프링 데이터 JPA 설정</h1>
<ul>
  <li><strong>필요 라이브러리</strong>
    <ul>
      <li>spring-data-jpa</li>
    </ul>
  </li>
</ul>

<details>
<summary style="color:rgb(200, 50, 50)"><b>설정</b></summary>
<div>

    <div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">&lt;!-- spring data JPA maven 라이브러리 설정 --&gt;</span>
<span class="nt">&lt;dependency&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>org.springframework.data<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>spring-data-jpa<span class="nt">&lt;/artifactId&gt;</span>
  <span class="nt">&lt;version&gt;</span>1.8.0.RELEASE<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</code></pre></div>    </div>

  </div>
</details>

<ul>
  <li><strong>환경설정</strong>
    <ul>
      <li>애플리케이션 실행 시 basePackage 에 있는 레포지토리 인터페이스들 찾아서 해당 인터페이스 구현한 클래스 동적 생성 후 빈으로 등록함</li>
      <li>스프링 설정에 XML 사용하는 경우
        <ul>
          <li><code class="language-plaintext highlighter-rouge">&lt;jpa:repositories&gt;</code> 추가
            <ul>
              <li>base-package 속성으로 레포지토리 검색할 패키지 위치 입력</li>
            </ul>
          </li>
        </ul>
      </li>
      <li>스프링 설정에 JavaConfig 사용하는 경우
        <ul>
          <li><code class="language-plaintext highlighter-rouge">org.springframework.data.jpa.repository.config.EnableJpaRepositories</code> 어노테이션 추가</li>
          <li>basePackages 속성에 리포지토리 검색할 패키지 위치 입력</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<details>
<summary style="color:rgb(200, 50, 50)"><b>코드</b></summary>
<div>

    <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// 스프링 설정에 JavaConfig 사용하는 경우</span>
<span class="nd">@Configuration</span>
<span class="nd">@EnableJpaRepositories</span><span class="o">(</span><span class="n">basePackages</span> <span class="o">=</span> <span class="s">"jpabook.jpashop.repository"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nf">AppConfig</span><span class="o">()</span> <span class="o">{</span>

<span class="o">}</span>
</code></pre></div>    </div>

  </div>
</details>

<details>
<summary style="color:rgb(200, 50, 50)"><b>설정</b></summary>
<div>

    <div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">&lt;!-- 스프링 설정에 XML 사용하는 경우 --&gt;</span>
<span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="nt">&lt;beans</span> <span class="na">xmlns=</span><span class="s">"http://www.springframework.org/schema/beans"</span>
  <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span>
  <span class="na">xmlns:jpa=</span><span class="s">"http://www.springfraework.org/schema/data/jpa"</span>
  <span class="na">xsi:schemeaLocation=</span><span class="s">"http://www.springfraework.org/schema/beans
    http//www.springfraework.org/schema/beans/spring-beans.xsd
    http://www.springfraework.org/schema/data/jpa
    http://www.springfraework.org/schema/data/jpa/spring-jpa.xsd"</span><span class="nt">&gt;</span>

  <span class="nt">&lt;jpa:repositories</span> <span class="na">base-package=</span><span class="s">"jpabook.jpashop.respotiroy"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/beans&gt;</span>
</code></pre></div>    </div>

  </div>
</details>

<p><br />
<br />
<br /></p>

<h1 id="123-공통-인터페이스-기능">12.3 공통 인터페이스 기능</h1>
<ul>
  <li>간단한 CRUD 기능을 공통으로 처리하는 JpaRepository 인터페이스를 제공
    <ul>
      <li>위 인터페이스 상속받아 제네릭에 엔티티 클래스, 엔티티 클래스가 사용하는 식별자 타입 지정해서 쓰면 됨</li>
    </ul>
  </li>
</ul>

<details>
<summary style="color:rgb(200, 50, 50)"><b>코드</b></summary>
<div>

    <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// JpaRepository 공통 기능 인터페이스</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">JpaRepository</span><span class="o">&lt;</span><span class="no">T</span><span class="o">,</span> <span class="no">ID</span> <span class="kd">extends</span> <span class="nc">Serializable</span><span class="o">&gt;</span> <span class="kd">extends</span> <span class="nc">PagingAndSortingRepository</span><span class="o">&lt;</span><span class="no">T</span><span class="o">,</span> <span class="no">ID</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="o">...</span>
<span class="o">}</span>

<span class="o">...</span>

<span class="c1">// JpaRepository 사용하는 인터페이스</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">MemberRepository</span> <span class="kd">extends</span> <span class="nc">JpaRepository</span><span class="o">&lt;</span><span class="nc">Member</span><span class="o">,</span> <span class="nc">Long</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="o">...</span>
<span class="o">}</span>
</code></pre></div>    </div>

  </div>
</details>

<p><img src="/assets/img/jpa_study/ch.12/pic-12-1.png" /></p>

<ul>
  <li>Repository, CrudRepository, PagingAndSortingRepository 는 Spring Data 가 공통으로 사용하는 인터페이스</li>
  <li>Spring Data JPA 의 JpaRepository 는 여기에 추가로 JPA 특화 기능을 제공</li>
  <li>Spring Data JPA 인터페이스의 주요 메소드는 아래와 같음 (T: 엔티티, ID: 엔티티 식별자 타입, S: 엔티티와 그 자식 타입)
    <ul>
      <li><strong>save(S):</strong> 새로운 엔티티(식별자 값 null)은 저장, 이미 있으면(식별자 값 not null) 수정
        <ul>
          <li>저장시엔 <code class="language-plaintext highlighter-rouge">EntityManager.persist()</code>, 수정시엔 <code class="language-plaintext highlighter-rouge">EntityManager.merge()</code> 호출</li>
        </ul>
      </li>
      <li><strong>delete(T):</strong> 엔티티 하나 삭제
        <ul>
          <li><code class="language-plaintext highlighter-rouge">EntityManager.remove()</code> 호출</li>
        </ul>
      </li>
      <li><strong>findOne(ID):</strong> 엔티티 하나를 조회
        <ul>
          <li><code class="language-plaintext highlighter-rouge">EntityManager.find()</code> 호출</li>
        </ul>
      </li>
      <li><strong>getOne(ID):</strong> 엔티티를 프록시로 조회
        <ul>
          <li><code class="language-plaintext highlighter-rouge">EntityManager.getReference()</code> 호출</li>
          <li><strong>DEPRECATED 됨</strong>
            <ul>
              <li>대신 <code class="language-plaintext highlighter-rouge">getById(ID)</code> 사용</li>
            </ul>
          </li>
        </ul>
      </li>
      <li><strong>findAll(…):</strong> 모든 엔티티를 조회
        <ul>
          <li>정렬, 페이징 조건을 파라미터로 제공 가능</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<p><br />
<br />
<br /></p>

<h1 id="124-쿼리-메소드-기능">12.4 쿼리 메소드 기능</h1>
<ul>
  <li>메소드 이름만으로 쿼리를 생성하는 기능</li>
  <li>인터페이스에 메소드 선언해두면 해당 메소드 이름으로 적절한 JPQL 쿼리 생성, 실행해줌</li>
  <li>쿼리 메소드 기능은 크게 다음 3가지
    <ul>
      <li><strong>메소드 이름으로 쿼리 생성</strong></li>
      <li><strong>메소드 이름으로 JPA NamedQuery 호출</strong></li>
      <li><strong>@Query 어노테이션을 사용해서 리포지토리 인터페이스에 쿼리 직접 정의</strong></li>
    </ul>
  </li>
</ul>

<p><br />
<br /></p>

<h2 id="1241-메소드-이름으로-쿼리-생성">12.4.1 메소드 이름으로 쿼리 생성</h2>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// 이메일과 이름으로 회원 조회하는 쿼리 메소드 정의</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">MemberRepository</span> <span class="kd">extends</span> <span class="nc">Repository</span><span class="o">&lt;</span><span class="nc">Member</span><span class="o">,</span> <span class="nc">Long</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Member</span><span class="o">&gt;</span> <span class="nf">findByEmailAndName</span><span class="o">(</span><span class="nc">String</span> <span class="n">email</span><span class="o">,</span> <span class="nc">String</span> <span class="n">name</span><span class="o">);</span>
<span class="o">}</span>

<span class="o">...</span>

<span class="c1">// 위 쿼리 메소드로 실행되는 JPQL</span>
<span class="s">"SELECT m "</span> <span class="o">+</span>
<span class="s">"FROM Member m "</span> <span class="o">+</span>
<span class="s">"WHERE m.email = ?1 "</span> <span class="o">+</span>
<span class="s">" AND m.name = ?2"</span><span class="o">;</span>
</code></pre></div></div>

<ul>
  <li>스프링 데이터 JPA 쿼리 생성 기능 키워드 및 예시</li>
</ul>

<table>
  <thead>
    <tr>
      <th style="text-align: left">키워드</th>
      <th style="text-align: left">예</th>
      <th style="text-align: left">JPQL 예</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">And</td>
      <td style="text-align: left">findByLastnameAndFirstname</td>
      <td style="text-align: left">… WHERE x.lastname = ?1 AND x.firstname = ?2</td>
    </tr>
    <tr>
      <td style="text-align: left">OR</td>
      <td style="text-align: left">findByLastnameOrFirstname</td>
      <td style="text-align: left">… WHERE x.lastname = ?1 or x.firstname = ?2</td>
    </tr>
    <tr>
      <td style="text-align: left">Is<br />Equals</td>
      <td style="text-align: left">findByFirstname<br />findByFirstnameIs<br />findByFirstnameEquals</td>
      <td style="text-align: left">… WHERE x.firstname = ?1</td>
    </tr>
    <tr>
      <td style="text-align: left">Between</td>
      <td style="text-align: left">findByStartDateBetween</td>
      <td style="text-align: left">… WHERE x.startDate BETWEEN ?1 AND ?2</td>
    </tr>
    <tr>
      <td style="text-align: left">LessThan</td>
      <td style="text-align: left">findByAgeLessThan</td>
      <td style="text-align: left">… WHERE x.age &lt; ?1&gt;</td>
    </tr>
    <tr>
      <td style="text-align: left">LessThanEqual</td>
      <td style="text-align: left">findByAgeLessThanEqual</td>
      <td style="text-align: left">… WHERE x.age &lt;= ?1</td>
    </tr>
    <tr>
      <td style="text-align: left">GreaterThan</td>
      <td style="text-align: left">findByAgeGreaterThan</td>
      <td style="text-align: left">… WHERE x.age &gt; ?1</td>
    </tr>
    <tr>
      <td style="text-align: left">GreaterThanEqual</td>
      <td style="text-align: left">findByAgeGreaterThanEqual</td>
      <td style="text-align: left">… WHERE x.age &gt;= ?1</td>
    </tr>
    <tr>
      <td style="text-align: left">After</td>
      <td style="text-align: left">findByStartDateAfter</td>
      <td style="text-align: left">… WHERE x.startDate &gt; ?1</td>
    </tr>
    <tr>
      <td style="text-align: left">Before</td>
      <td style="text-align: left">findByStartDateBefore</td>
      <td style="text-align: left">… WHERE x.startDate &lt; ?1</td>
    </tr>
    <tr>
      <td style="text-align: left">IsNull</td>
      <td style="text-align: left">findByAgeIsNull</td>
      <td style="text-align: left">… WHERE x.age IS NULL</td>
    </tr>
    <tr>
      <td style="text-align: left">IsNotNull<br />NotNull</td>
      <td style="text-align: left">findByAgeIsNotNull<br />findByAgeNotNull</td>
      <td style="text-align: left">WHERE x.age NOT NULL</td>
    </tr>
    <tr>
      <td style="text-align: left">Like</td>
      <td style="text-align: left">findByFirstnameLike</td>
      <td style="text-align: left">… WHERE x.firstname LIKE ?1</td>
    </tr>
    <tr>
      <td style="text-align: left">NotLike</td>
      <td style="text-align: left">findByFirstnameNotLike</td>
      <td style="text-align: left">… WHERE x.firstname NOT LIKE ?1</td>
    </tr>
    <tr>
      <td style="text-align: left">StartingWith</td>
      <td style="text-align: left">findByFirstnameStartingWith</td>
      <td style="text-align: left">… WHERE x.firstname LIKE ?1<br />(paramter bound with appended %)</td>
    </tr>
    <tr>
      <td style="text-align: left">EndingWith</td>
      <td style="text-align: left">findByFirstname EdingWith</td>
      <td style="text-align: left">… WHERE x.firstname LIKE ?1<br />(paramter bound with prepended %)</td>
    </tr>
    <tr>
      <td style="text-align: left">Containing</td>
      <td style="text-align: left">findByFirstnameContaining</td>
      <td style="text-align: left">… WHERE x.firstname LIKE ?1<br />(parametr bound wrapped in %)</td>
    </tr>
    <tr>
      <td style="text-align: left">OrderBy</td>
      <td style="text-align: left">findByAgeOrderByLastnameDesc</td>
      <td style="text-align: left">… WHERE x.age = ?1 ORDER BY x.lastname DESC</td>
    </tr>
    <tr>
      <td style="text-align: left">Not</td>
      <td style="text-align: left">findByLastnameNot</td>
      <td style="text-align: left">… WHERE x.lastname &lt;&gt; ?1</td>
    </tr>
    <tr>
      <td style="text-align: left">In</td>
      <td style="text-align: left">findByAgeIn(Collection ages)</td>
      <td style="text-align: left">… WHERE x.age IN ?1</td>
    </tr>
    <tr>
      <td style="text-align: left">NotIn</td>
      <td style="text-align: left">infdByAgeNotIn(Collection ages)</td>
      <td style="text-align: left">… WHERE x.age NOT IN ?1</td>
    </tr>
    <tr>
      <td style="text-align: left">True</td>
      <td style="text-align: left">findByAcitveTrue()</td>
      <td style="text-align: left">… WHERE x.active = true</td>
    </tr>
    <tr>
      <td style="text-align: left">Falce</td>
      <td style="text-align: left">findByActiveFalse()</td>
      <td style="text-align: left">… WHERE x.active = false</td>
    </tr>
    <tr>
      <td style="text-align: left">IgnoreCase</td>
      <td style="text-align: left">findByFirstnameIgnoreCase</td>
      <td style="text-align: left">… WHERE UPPER(x.firstname) = UPPDER(?1)</td>
    </tr>
  </tbody>
</table>

<p><br />
<br /></p>

<h2 id="1242-jpa-namedquery">12.4.2 JPA NamedQuery</h2>
<ul>
  <li>쿼리 생성 기능 이용해서 메소드 만들면 우선 선언한 “도메인 클래스 + . + 메소드 이름”으로 Named 쿼리 찾음
    <ul>
      <li>있으면 해당 쿼리 사용</li>
      <li>없으면 쿼리 생성 전략 사용해서 만듬</li>
    </ul>
  </li>
</ul>

<details>
<summary style="color:rgb(200, 50, 50)"><b>코드</b></summary>
<div>

    <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// named query 정의</span>
<span class="nd">@Entity</span>
<span class="nd">@NamedQuery</span><span class="o">(</span>
  <span class="n">name</span><span class="o">=</span><span class="s">"Member.findByUsername"</span><span class="o">,</span> <span class="c1">// {도메인 클래스}.{메소드 이름} 으로 named query 이름 설정</span>
  <span class="n">query</span><span class="o">=</span><span class="s">"SELECT m FROM Member m WHERE m.username = :username"</span><span class="o">)</span>
<span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Member</span> <span class="o">{</span>
  <span class="o">...</span>
<span class="o">}</span>

<span class="o">...</span>

<span class="c1">// Spring Data JPA 로 named query 호출</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">MemberRepository</span> <span class="kd">extends</span> <span class="nc">JpaRepository</span><span class="o">&lt;</span><span class="nc">Member</span><span class="o">,</span> <span class="nc">Long</span><span class="o">&gt;</span> <span class="o">{</span> <span class="c1">// 여기 선언한 Member 도메인 클래스 사용</span>
  <span class="c1">// {위의 Member 도메인 클래스}.{아래 메소드 이름} = Member.findByUsername 으로 설정된 Named query 있나 먼저 찾음</span>
  <span class="c1">// 있으면 사용, 없으면 쿼리 메소드 생성 기능으로 만들어줌</span>
  <span class="nc">List</span><span class="o">&lt;</span><span class="nc">MembeR</span><span class="o">&gt;</span> <span class="nf">findByUsername</span><span class="o">(</span><span class="nd">@Param</span><span class="o">(</span><span class="s">"username"</span><span class="o">)</span> <span class="nc">String</span> <span class="n">username</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div>    </div>

  </div>
</details>

<p><br />
<br /></p>

<h2 id="1243-query-레포지토리-메소드에-쿼리-정의">12.4.3 @Query, 레포지토리 메소드에 쿼리 정의</h2>
<ul>
  <li><code class="language-plaintext highlighter-rouge">@org.springframework.data.jpa.repository.Query</code> 어노테이션 붙여서 직접 쿼리 정의 가능</li>
  <li>일종의 이름없는 Named 쿼리</li>
  <li>애플리케이션 실행 시점에 문법 오류 발견할 수 있음</li>
  <li>네이티브 SQL 사용하려면 <code class="language-plaintext highlighter-rouge">@Query</code> 메소드의 nativeeQuery 속성 true 로 설정</li>
</ul>

<details>
<summary style="color:rgb(200, 50, 50)"><b>코드</b></summary>
<div>

    <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// 메소드에 JPQL 쿼리 작성</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">MemberRepository</span> <span class="kd">extends</span> <span class="nc">JpaRepository</span><span class="o">&lt;</span><span class="nc">Member</span><span class="o">,</span> <span class="nc">Long</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="nd">@Query</span><span class="o">(</span><span class="s">"SELECT m FROM Member m WHERE m.username = ?1"</span><span class="o">)</span>
  <span class="nc">Member</span> <span class="nf">findByUsername</span><span class="o">(</span><span class="nc">String</span> <span class="n">username</span><span class="o">);</span>
<span class="o">}</span>

<span class="o">...</span>

<span class="c1">// JPA 네이티브 SQL 지원</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">MemberRepository</span> <span class="kd">extends</span> <span class="nc">JpaRepository</span><span class="o">&lt;</span><span class="nc">Member</span><span class="o">,</span> <span class="nc">Long</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="nd">@Query</span><span class="o">(</span><span class="s">"SELECT m FROM Member m WHERE m.username = ?0"</span><span class="o">,</span> <span class="n">nativeQuery</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
  <span class="nc">Member</span> <span class="nf">findByUsername</span><span class="o">(</span><span class="nc">String</span> <span class="n">username</span><span class="o">);</span>
<span class="o">}</span>

</code></pre></div>    </div>

  </div>
</details>

<p><br />
<br /></p>

<h2 id="1244-파라미터-바인딩">12.4.4 파라미터 바인딩</h2>
<ul>
  <li>위치 기반, 이름 기반 파라미터 바인딩 둘 다 지원
    <ul>
      <li><code class="language-plaintext highlighter-rouge">SELECT m FROM Member m WHERE m.username = ?1 // 위치 기반</code></li>
      <li><code class="language-plaintext highlighter-rouge">SELECT m FROM Member m WHERE m.username = :name // 이름 기반</code></li>
    </ul>
  </li>
  <li>기본 값은 위치 기반
    <ul>
      <li>JPQL 에서는 1 부터, Native SQL 에서는 0 부터 시작</li>
    </ul>
  </li>
  <li>이름 기반 파라미터 바인딩 쓰려면 <code class="language-plaintext highlighter-rouge">@org.springframework.data.repository.query.Param(파라미터 이름)</code> 어노테이션 파라미터에 붙여주면 됨</li>
</ul>

<details>
<summary style="color:rgb(200, 50, 50)"><b>코드</b></summary>
<div>

    <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">MemberRepository</span> <span class="kd">extends</span> <span class="nc">JpaRepository</span><span class="o">&lt;</span><span class="nc">Member</span><span class="o">,</span> <span class="nc">Long</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="nd">@Query</span><span class="o">(</span><span class="s">"SELECT m FROM Member m WHERE m.username = :name"</span><span class="o">)</span>
  <span class="nc">Member</span> <span class="nf">findByUsername</span><span class="o">(</span><span class="nd">@Param</span><span class="o">(</span><span class="s">"name"</span><span class="o">)</span> <span class="nc">Stirng</span> <span class="n">username</span><span class="o">);</span>  <span class="c1">// @Param으로 설정해준 name 파라미터로 username 바인딩 됨</span>
<span class="o">}</span>
</code></pre></div>    </div>

  </div>
</details>

<p><br />
<br /></p>

<h2 id="1245-벌크성-수정-쿼리">12.4.5 벌크성 수정 쿼리</h2>
<ul>
  <li><code class="language-plaintext highlighter-rouge">@org.springframework.data.jpa.repository.Modifying</code> 어노테이션 사용</li>
  <li>벌크성 쿼리 실행 후 영속성 컨텍스트 초기화하게 하려면 clearAutomatically 속성 true로 설정하면 됨 (default는 false)
    <ul>
      <li><code class="language-plaintext highlighter-rouge">@Modifying(clearAutomatically = true)</code></li>
    </ul>
  </li>
</ul>

<details>
<summary style="color:rgb(200, 50, 50)"><b>코드</b></summary>
<div>

    <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Modifying</span>
<span class="nd">@Query</span><span class="o">(</span><span class="s">"UPDATE Product p SET p.price = p.price * 1.1 WHERE p.stockAmount &lt; :sotckAmount"</span><span class="o">)</span>
<span class="kt">int</span> <span class="nf">bulkPriceUp</span><span class="o">(</span><span class="nd">@Param</span><span class="o">(</span><span class="s">"stockAmount"</span><span class="o">)</span> <span class="nc">String</span> <span class="n">stockAmount</span><span class="o">);</span>
</code></pre></div>    </div>

  </div>
</details>

<p><br />
<br /></p>

<h2 id="1246-반환-타입">12.4.6 반환 타입</h2>
<ul>
  <li>결과 2 건 이상이면 컬렉션 인터페이스
    <ul>
      <li><code class="language-plaintext highlighter-rouge">List&lt;Member&gt; findByName(String name);  // 컬렉션</code></li>
      <li>조회 결과 없으면 빈 컬렉션 반환</li>
    </ul>
  </li>
  <li>단건이면 반환 타입을 지정
    <ul>
      <li><code class="language-plaintext highlighter-rouge">Member findByEmail(String email);  // 단건</code></li>
      <li>조회 결과 없으면 null 반환</li>
      <li>반환 타입 지정했는데 결과 2 건 이상이면 예외 발생</li>
    </ul>
  </li>
</ul>

<p><br />
<br /></p>

<h2 id="1247-페이징과-정렬">12.4.7 페이징과 정렬</h2>
<ul>
  <li>쿼리 메소드에 페이징 및 정렬 기능 사용할 수 있도록 2가지 파라미터 제공
    <ul>
      <li><code class="language-plaintext highlighter-rouge">org.springfraework.data.domain.Sort</code>: 정렬 기능</li>
      <li><code class="language-plaintext highlighter-rouge">org.springframework.data.domain.Pageable</code>: 페이징 기능(내부에 <code class="language-plaintext highlighter-rouge">Sort</code> 포함되어 있음)</li>
    </ul>
  </li>
  <li><code class="language-plaintext highlighter-rouge">Pageable</code> 사용 시 반환 타입으로 <code class="language-plaintext highlighter-rouge">List</code>, <code class="language-plaintext highlighter-rouge">org.springframework.data.domain.Page</code> 사용 가능
    <ul>
      <li>반환 타입으로 <code class="language-plaintext highlighter-rouge">Page</code> 사용하면 검색된 전체 데이터 건수 조회하는 COUNT 쿼리를 추가로 호출함</li>
    </ul>
  </li>
  <li><code class="language-plaintext highlighter-rouge">Pageable</code>은 인터페이스 이므로 실제 사용시엔 해당 인터페이스 구현체임 <code class="language-plaintext highlighter-rouge">org.springframework.data.domain.PageRequest</code> 객체 사용
    <ul>
      <li><code class="language-plaintext highlighter-rouge">new PageRequest(현재 페이지, 조회할 데이터 수);</code></li>
      <li><code class="language-plaintext highlighter-rouge">new PageRequest(현재 페이지, 조회할 데이터 수, new Sort(정렬 방식, 정렬 기준 필드)); // 세 번째 파라미터로 정렬 정보도 추가 가능</code></li>
    </ul>
  </li>
</ul>

<details>
<summary style="color:rgb(200, 50, 50)"><b>코드</b></summary>
<div>

    <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Page 사용 예제 정의 코드</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">MemberRepository</span> <span class="kd">extends</span> <span class="nc">Repository</span><span class="o">&lt;</span><span class="nc">Member</span><span class="o">,</span> <span class="nc">Long</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="nc">Page</span><span class="o">&lt;</span><span class="nc">Member</span><span class="o">&gt;</span> <span class="nf">findByNameStartingWith</span><span class="o">(</span><span class="nc">String</span> <span class="n">name</span><span class="o">,</span> <span class="nc">Pageable</span> <span class="n">pageable</span><span class="o">);</span>
<span class="o">}</span>

<span class="o">...</span>

<span class="c1">// Page 사용 예제 실행 코드</span>
<span class="c1">// 페이징 조건, 정렬 조건 설정</span>
<span class="nc">PageRequest</span> <span class="n">pageRequest</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">PageRequest</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">10</span><span class="o">,</span> <span class="k">new</span> <span class="nc">Sort</span><span class="o">(</span><span class="nc">Direction</span><span class="o">.</span><span class="na">DESC</span><span class="o">,</span> <span class="s">"name"</span><span class="o">));</span>

<span class="nc">Page</span><span class="o">&lt;</span><span class="nc">Member</span><span class="o">&gt;</span> <span class="n">result</span> <span class="o">=</span> <span class="n">memberRepository</span><span class="o">.</span><span class="na">findByNameStartingWith</span><span class="o">(</span><span class="s">"Kim"</span><span class="o">,</span> <span class="n">pageRequest</span><span class="o">);</span>

<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Member</span><span class="o">&gt;</span> <span class="n">members</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="na">getContent</span><span class="o">();</span> <span class="c1">// 조회 결과 데이터</span>
<span class="kt">int</span> <span class="n">totalPages</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="na">getTotalPages</span><span class="o">();</span>  <span class="c1">// 전체 페이지 수</span>
<span class="kt">boolean</span> <span class="n">hasNextPage</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="na">hasNextPage</span><span class="o">();</span> <span class="c1">// 다음 페이지 존재 여부</span>
</code></pre></div>    </div>

  </div>
</details>

<ul>
  <li><code class="language-plaintext highlighter-rouge">Page</code> 인터페이스가 제공하는 메소드들은 아래와 같음</li>
</ul>

<table>
  <thead>
    <tr>
      <th style="text-align: left">메소드</th>
      <th style="text-align: left">반환 타입</th>
      <th style="text-align: left">설명</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">getNumber()</td>
      <td style="text-align: left">int</td>
      <td style="text-align: left">현재 페이지</td>
    </tr>
    <tr>
      <td style="text-align: left">getSize()</td>
      <td style="text-align: left">int</td>
      <td style="text-align: left">페이지 크기</td>
    </tr>
    <tr>
      <td style="text-align: left">getTotalPages()</td>
      <td style="text-align: left">int</td>
      <td style="text-align: left">전체 페이지 수</td>
    </tr>
    <tr>
      <td style="text-align: left">getNumberOfElements()</td>
      <td style="text-align: left">int</td>
      <td style="text-align: left">현재 페이지에 나올 데이터 수</td>
    </tr>
    <tr>
      <td style="text-align: left">getTotalElements()</td>
      <td style="text-align: left">long</td>
      <td style="text-align: left">전체 데이터 수</td>
    </tr>
    <tr>
      <td style="text-align: left">hasPreviousPage()</td>
      <td style="text-align: left">boolean</td>
      <td style="text-align: left">이전 페이지 존재 여부</td>
    </tr>
    <tr>
      <td style="text-align: left">isFirstPage()</td>
      <td style="text-align: left">boolean</td>
      <td style="text-align: left">현재 페이지가 첫 페이지 인지 여부</td>
    </tr>
    <tr>
      <td style="text-align: left">hasNextPage()</td>
      <td style="text-align: left">boolean</td>
      <td style="text-align: left">다음 페이지 존재 여부</td>
    </tr>
    <tr>
      <td style="text-align: left">isLastPage()</td>
      <td style="text-align: left">boolean</td>
      <td style="text-align: left">현재 페이지가 마지막 페이지 인지 여부</td>
    </tr>
    <tr>
      <td style="text-align: left">nextPageable()</td>
      <td style="text-align: left">Pageable</td>
      <td style="text-align: left">다음 페이지 객체, 없으면 null</td>
    </tr>
    <tr>
      <td style="text-align: left">previousPageable()</td>
      <td style="text-align: left">Pageable</td>
      <td style="text-align: left">이전 페이지 객체, 없으면 null</td>
    </tr>
    <tr>
      <td style="text-align: left">getContent()</td>
      <td style="text-align: left">List<T></T></td>
      <td style="text-align: left">조회된 데이터</td>
    </tr>
    <tr>
      <td style="text-align: left">hasContent()</td>
      <td style="text-align: left">boolean</td>
      <td style="text-align: left">조회된 데이터 존재 여부</td>
    </tr>
    <tr>
      <td style="text-align: left">getSort()</td>
      <td style="text-align: left">Sort</td>
      <td style="text-align: left">정렬 정보</td>
    </tr>
  </tbody>
</table>

<p><br />
<br /></p>

<h2 id="1248-힌트">12.4.8 힌트</h2>
<ul>
  <li><code class="language-plaintext highlighter-rouge">@org.springframework.data.jpa.repository.QueryHints</code> 어노테이션 사용
    <ul>
      <li>JPA 구현체에게 제공하는 힌트</li>
    </ul>
  </li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// 쿼리 힌트 예시</span>
<span class="nd">@QueryHints</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="o">{</span>
  <span class="nd">@QueryHint</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"org.hibernate.readOnly"</span><span class="o">,</span> <span class="n">value</span><span class="o">=</span><span class="s">"true"</span><span class="o">)</span>
<span class="o">},</span> <span class="n">forCounting</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>  <span class="c1">// 반환 타입으로 Page 인터페이스 적용 시 추가 호출되는 COUNT 쿼리에도 힌트 적용할 지 설정하는 옵션. default값 true</span>
<span class="nc">Page</span><span class="o">&lt;</span><span class="nc">Member</span><span class="o">&gt;</span> <span class="nf">findByName</span><span class="o">(</span><span class="nc">String</span> <span class="n">name</span><span class="o">,</span> <span class="nc">Pageable</span> <span class="n">pageable</span><span class="o">);</span>
</code></pre></div></div>

<p><br />
<br /></p>

<h2 id="1249-lock">12.4.9 Lock</h2>
<ul>
  <li><code class="language-plaintext highlighter-rouge">@org.springframework.data.jpa.repository.Lock</code> 어노테이션 사용</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Lock 예시</span>
<span class="nd">@Lock</span><span class="o">(</span><span class="nc">LockModeType</span><span class="o">.</span><span class="na">PESSIMISTIC_WRITE</span><span class="o">)</span>
<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Member</span><span class="o">&gt;</span> <span class="nf">findByName</span><span class="o">(</span><span class="nc">String</span> <span class="n">name</span><span class="o">);</span>
</code></pre></div></div>

<p><br />
<br />
<br /></p>

<h1 id="125-명세">12.5 명세</h1>
<ul>
  <li>술어(predicate): 명세(specification)를 이해하기 위한 핵심
    <ul>
      <li>단순히 참, 거짓으로 평가</li>
      <li>AND, OR 같은 연산자로 조합 가능</li>
      <li>ex) 데이터를 검색하기 위한 제약 조건 하나 하나를 술어로 볼 수 있음</li>
      <li>스프링 데이터 JPA는 <code class="language-plaintext highlighter-rouge">org.springframework.data.jpa.domain.Specification</code> 클래스로 정의</li>
    </ul>
  </li>
  <li><code class="language-plaintext highlighter-rouge">Specification</code> 은 composite pattern으로 구성되어 여러 <code class="language-plaintext highlighter-rouge">Specification</code> 을 조합할 수 있음
    <ul>
      <li>명세들을 조립할 수 있도록 도와주는 클래스</li>
    </ul>
  </li>
  <li><code class="language-plaintext highlighter-rouge">Specifications</code> 는 <code class="language-plaintext highlighter-rouge">Specification</code> 들을 조립할 수 있도록 도와주는 클래스
    <ul>
      <li><code class="language-plaintext highlighter-rouge">where()</code>, <code class="language-plaintext highlighter-rouge">and()</code>, <code class="language-plaintext highlighter-rouge">or()</code>, <code class="language-plaintext highlighter-rouge">not()</code> 메소드 제공</li>
    </ul>
  </li>
  <li>명세 기능 사용하려면 <code class="language-plaintext highlighter-rouge">org.springframework.data.jpa.repository.JpaSepcificationExecutor</code> 인터페이스 상속
    <ul>
      <li><code class="language-plaintext highlighter-rouge">JpaSpecificationExecutor</code>의 메소드들은 <code class="language-plaintext highlighter-rouge">Specification</code>을 파라미터로 받아서 검색 조건으로 사용</li>
    </ul>
  </li>
</ul>

<details>
<summary style="color:rgb(200, 50, 50)"><b>코드</b></summary>
<div>

    <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// JpaSepcificationExecutor 인터페이스</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">JpaSpecificationExecutor</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="no">T</span> <span class="nf">findOne</span><span class="o">(</span><span class="nc">Specification</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="n">spec</span><span class="o">);</span>
  <span class="nc">List</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="nf">findAll</span><span class="o">(</span><span class="nc">Specification</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="n">spec</span><span class="o">);</span>
  <span class="nc">Page</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="nf">findAll</span><span class="o">(</span><span class="nc">Specification</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="n">spec</span><span class="o">,</span> <span class="nc">Pageable</span> <span class="n">pageable</span><span class="o">);</span>
  <span class="nc">List</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="nf">findAll</span><span class="o">(</span><span class="nc">Specification</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="n">spec</span><span class="o">,</span> <span class="nc">Sort</span> <span class="n">sort</span><span class="o">);</span>
  <span class="kt">long</span> <span class="nf">count</span><span class="o">(</span><span class="nc">Specification</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="n">spec</span><span class="o">);</span>
<span class="o">}</span>

<span class="o">...</span>

<span class="c1">// JpaSepcificationExecutor 상속</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">OrderRepository</span> <span class="kd">extends</span> <span class="nc">JpaRepository</span><span class="o">&lt;</span><span class="nc">Order</span><span class="o">,</span> <span class="nc">Long</span><span class="o">&gt;,</span> <span class="nc">JpaSpecificationExecutor</span><span class="o">&lt;</span><span class="nc">Order</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="o">...</span>
<span class="o">}</span>

<span class="o">...</span>

<span class="c1">// Specification 정의 예제</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">OrderSpec</span> <span class="o">{</span>
  <span class="c1">// memberName Specification를 anonymous class로 정의해서 리턴</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="nc">Specification</span><span class="o">&lt;</span><span class="nc">Order</span><span class="o">&gt;</span> <span class="nf">memberName</span><span class="o">(</span><span class="kd">final</span> <span class="nc">String</span> <span class="n">memberName</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nc">Specification</span><span class="o">&lt;</span><span class="nc">Order</span><span class="o">&gt;()</span> <span class="o">{</span>
      <span class="c1">// Specifcation 은 toPredicate만 정의하면 됨</span>
      <span class="kd">public</span> <span class="nc">Predicate</span> <span class="nf">toPredicate</span><span class="o">(</span><span class="nc">Root</span><span class="o">&lt;</span><span class="nc">Order</span><span class="o">&gt;</span> <span class="n">root</span><span class="o">,</span> <span class="nc">CriteriaQuery</span><span class="o">&lt;?&gt;</span> <span class="n">query</span><span class="o">,</span> <span class="nc">CriteriaBuilder</span> <span class="n">builder</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="nc">StringUtils</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">(</span><span class="n">memberName</span><span class="o">))</span> <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>

        <span class="nc">Join</span><span class="o">&lt;</span><span class="nc">Order</span><span class="o">,</span> <span class="nc">Member</span><span class="o">&gt;</span> <span class="n">m</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="na">join</span><span class="o">(</span><span class="s">"member"</span><span class="o">,</span> <span class="nc">JoinType</span><span class="o">.</span><span class="na">INNER</span><span class="o">);</span>
        
        <span class="k">return</span> <span class="n">builder</span><span class="o">.</span><span class="na">equal</span><span class="o">(</span><span class="n">m</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"name"</span><span class="o">),</span> <span class="n">memberName</span><span class="o">);</span>
      <span class="o">}</span>
    <span class="o">};</span>
  <span class="o">}</span>

  <span class="c1">// isOrderStatus Specification를 anonymous class로 정의해서 리턴</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="nc">Specification</span><span class="o">&lt;</span><span class="nc">Order</span><span class="o">&gt;</span> <span class="nf">isOrderStatus</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nc">Specification</span><span class="o">&lt;</span><span class="nc">Order</span><span class="o">&gt;()</span> <span class="o">{</span>
      <span class="kd">public</span> <span class="nc">Predicate</span> <span class="nf">toPredicate</span><span class="o">(</span><span class="nc">Root</span><span class="o">&lt;</span><span class="nc">Order</span><span class="o">&gt;</span> <span class="n">root</span><span class="o">,</span> <span class="nc">CriteriaQuery</span><span class="o">&lt;?&gt;</span> <span class="n">query</span><span class="o">,</span> <span class="nc">CriteriaBuilder</span> <span class="n">builder</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">builder</span><span class="o">.</span><span class="na">equal</span><span class="o">(</span><span class="n">root</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"status"</span><span class="o">),</span> <span class="nc">OrderStatus</span><span class="o">.</span><span class="na">ORDER</span><span class="o">);</span>
      <span class="o">}</span>
    <span class="o">};</span>
  <span class="o">}</span>
<span class="o">}</span>

<span class="o">...</span>

<span class="c1">// Specification 사용 예제</span>
<span class="kd">public</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Order</span><span class="o">&gt;</span> <span class="nf">findOrders</span><span class="o">(</span><span class="nc">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
  <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Order</span><span class="o">&gt;</span> <span class="n">result</span> <span class="o">=</span> <span class="n">orderRepository</span><span class="o">.</span><span class="na">findAll</span><span class="o">(</span>
    <span class="n">where</span><span class="o">(</span><span class="n">memberName</span><span class="o">(</span><span class="n">name</span><span class="o">)).</span><span class="na">and</span><span class="o">(</span><span class="n">isOrderStatus</span><span class="o">())</span>  <span class="c1">// 위에서 정의한 Specification들을 Specifications 메소드들로 엮어서 검색 조건으로 사용</span>
  <span class="o">);</span>

  <span class="k">return</span> <span class="n">result</span>
<span class="o">}</span>
</code></pre></div>    </div>

  </div>
</details>

<p><br />
<br />
<br /></p>

<h1 id="126-사용자-정의-레포지토리-구현">12.6 사용자 정의 레포지토리 구현</h1>
<ul>
  <li>인터페이스로 자동 생성되는 구현체 외에 추가로 메소드를 직접 구현해야할 때 필요한 메소드만 딱 구현할 수 있음
    <ul>
      <li>사용자 정의 인터페이스 작성
        <ul>
          <li>직접 구현할 메소드 추가</li>
        </ul>
      </li>
      <li>해당 사용자 정의 인터페이스를 구현한 클래스 작성
        <ul>
          <li>이 때 구현 클래스 이름은 {레포지토리 인터페이스 이름}Impl 로 해야함</li>
          <li>다른 이름 쓰려면 <code class="language-plaintext highlighter-rouge">repository-impl-postfix</code> 속성을 변경하면 됨</li>
        </ul>
      </li>
      <li>레포지토리 인터페이스에서 사용자 정의 인터페이스를 상속</li>
    </ul>
  </li>
</ul>

<details>
<summary style="color:rgb(200, 50, 50)"><b>코드</b></summary>
<div>

    <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// 사용자 정의 인터페이스</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">MemberRepositoryCustom</span> <span class="o">{</span>
  <span class="c1">// 직접 작성할 메소드</span>
  <span class="kd">public</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Member</span><span class="o">&gt;</span> <span class="nf">findMemberCustom</span><span class="o">();</span>
<span class="o">}</span>

<span class="o">...</span>

<span class="c1">// 사용자 정의 구현 클래스</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MemberRepositoryImpl</span> <span class="kd">implements</span> <span class="nc">MemberRepositoryCustom</span> <span class="o">{</span> <span class="c1">// 이름은 레포지토리 인터페이스 이름 + Impl</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Member</span><span class="o">&gt;</span> <span class="nf">findMemberCustom</span><span class="o">()</span> <span class="o">{</span>
    <span class="o">...</span> <span class="c1">// 구현</span>
  <span class="o">}</span>
<span class="o">}</span>

<span class="o">...</span>

<span class="c1">// 사용자 정의 인터페이스 상속</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">MemberRepository</span> <span class="kd">extends</span> <span class="nc">JpaRepository</span><span class="o">&lt;</span><span class="nc">Member</span><span class="o">,</span> <span class="nc">Long</span><span class="o">&gt;,</span> <span class="nc">MemberRepositoryCustom</span> <span class="o">{</span>
  <span class="o">...</span>
<span class="o">}</span>
</code></pre></div>    </div>

  </div>
</details>

<details>
<summary style="color:rgb(200, 50, 50)"><b>설정</b></summary>
<div>

    <div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">&lt;!-- xml로 사용자 정의 구현 클래스 이름 규칙 --&gt;</span>
<span class="nt">&lt;repositories</span> <span class="na">base-package=</span><span class="s">"jpabook.jpashop.repository"</span>
  <span class="na">repository-impl-postfix=</span><span class="s">"Impl"</span> <span class="nt">/&gt;</span> 
</code></pre></div>    </div>

    <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@EnableJpaRepositories</span><span class="o">(</span><span class="n">basePackages</span> <span class="o">=</span> <span class="s">"jpabook.jpashop.repository"</span><span class="o">,</span>
  <span class="n">repositoryImplementationsPostfix</span> <span class="o">=</span> <span class="s">"Impl"</span><span class="o">)</span>
</code></pre></div>    </div>

  </div>
</details>

<p><br />
<br />
<br /></p>

<h1 id="127-web-확장">12.7 Web 확장</h1>
<ul>
  <li>스플링 데이터 프로젝트는 스프링 MVC에서 사용할 수 있는 편의기능들 제공
    <ul>
      <li>식별자로 도메인 클래스를 바로 바인딩 해주는 도메인 클래스 컨버터 기능</li>
      <li>페이징과 정렬 기능</li>
    </ul>
  </li>
</ul>

<p><br />
<br /></p>

<h2 id="1271-설정">12.7.1 설정</h2>
<ul>
  <li><code class="language-plaintext highlighter-rouge">org.springframework.data.web.config.SpringDataWebConfiguration</code> 을 스프링 빈으로 등록</li>
  <li>JavaConfig 사용시에는 <code class="language-plaintext highlighter-rouge">@org.springframework.data.web.config.EnableSpringDataWebSupport</code> 어노테이션 사용</li>
  <li>설정하면 도메인 클래스 컨버터와 페이징 정렬 위한 <code class="language-plaintext highlighter-rouge">HandlerMethodArgumentResolver</code> 가 스프링 빈으로 등록됨
    <ul>
      <li>등록되는 도메인 클래스 컨버터는 <code class="language-plaintext highlighter-rouge">org.springframework.data.repository.support.DomainClassConverter</code></li>
    </ul>
  </li>
</ul>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">&lt;!-- xml로 web 확장 기능 활성화 --&gt;</span>
<span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">"org.springframework.data.web.config.SpringDataWebConfiguration"</span> <span class="nt">/&gt;</span>
</code></pre></div></div>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// JavaConfig 으로 web 확장 기능 활성화</span>
<span class="nd">@Configuration</span>
<span class="nd">@EnableWebMvc</span>
<span class="nd">@EnableSpringDataWebSupport</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">WebAppConfig</span> <span class="o">{</span>
  <span class="o">...</span>
<span class="o">}</span>
</code></pre></div></div>

<p><br />
<br /></p>

<h2 id="1272-도메인-클래스-컨버터-기능">12.7.2 도메인 클래스 컨버터 기능</h2>
<ul>
  <li>HTTP 파라미터로 넘어온 엔티티의 아이디로 엔티티 객체 찾아서 바로 바인딩
    <ul>
      <li>ex) <code class="language-plaintext highlighter-rouge">/member/memberUpdateForm?id=1</code>와 같은 url로 회원 정보 수정 요청오면 id 파라미터로 조회해서 엔티티 객체를 바인딩 해서 넘겨줌</li>
      <li>컨트롤러에서는 id 로 조회해서 사용할 필요 없이 바로 엔티티 객체 받아서 쓰면 됨</li>
      <li>이 때 도메인 클래스 컨버터는 해당 엔티티와 관련된 레포지토리 사용해서 조회함</li>
    </ul>
  </li>
</ul>

<details>
<summary style="color:rgb(200, 50, 50)"><b>코드</b></summary>
<div>

    <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Controller</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MemberController</span> <span class="o">{</span>
  <span class="c1">// URL: /member/memberUpdateForm?id=1</span>
  <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">"member/memberUpdateForm"</span><span class="o">)</span>
  <span class="c1">// 도메인 클래스 컨버터가 중간에서 request parameter로 넘어온 id로 Member 조회해서 컨트롤러에 변환된 객체를 넘겨줌</span>
  <span class="kd">public</span> <span class="nc">String</span> <span class="nf">memberUpdateForm</span><span class="o">(</span><span class="nd">@RequestParam</span><span class="o">(</span><span class="s">"id"</span><span class="o">)</span> <span class="nc">Member</span> <span class="n">member</span><span class="o">,</span><span class="nc">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">"member"</span><span class="o">,</span> <span class="n">member</span><span class="o">);</span>

    <span class="k">return</span> <span class="s">"member/memberSaveForm"</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div>    </div>

  </div>
</details>

<blockquote>
  <p>도메인 클래스 컨버터로 넘어온 엔티티는 컨트롤러에서 수정해도 DB 반영 안됨<br />
=&gt; 영속성 컨텍스트의 동작 방식 때문<br />
<strong>OSIV 사용하지 않는 경우:</strong> 조회한 엔티티는 준영속. 따라서 변경 감지 X. 
수정한 내용 반영하려면 merge 해야함
<strong>OSIV 사용하는 경우:</strong> 엔티티는 영속. 하지만 OSIV 특성상 컨트롤러와 뷰에서는 영속성 컨텍스트 플러시 안함. 
수정한 내용 반영하려면 트랜잭션을 시작하는 서비스 레이어 호출해야 함. 해당 서비스 레이어 종료시 플러시 및 트랜잭션 커밋 일어나서 변경 내용 반영됨</p>
</blockquote>

<p><br />
<br /></p>

<h2 id="1273-페이징과-정렬-기능">12.7.3 페이징과 정렬 기능</h2>
<ul>
  <li><code class="language-plaintext highlighter-rouge">HandlerMethodArgumentResolver</code> 로 스프링 데이터의 페이징 및 정렬 기능 사용 가능
    <ul>
      <li>페이징 기능: <code class="language-plaintext highlighter-rouge">PageableHandlerMethodArgumentResolver</code></li>
      <li>정렬 기능: <code class="language-plaintext highlighter-rouge">SortHandlerMethodArgumentResolver</code></li>
    </ul>
  </li>
  <li>파라미터로 <code class="language-plaintext highlighter-rouge">Pageable</code> 받아올 수 있음
    <ul>
      <li>요청 파라미터
        <ul>
          <li>page: 현재 페이지. 0 부터 시작</li>
          <li>size: 한 페이지에 노출할 데이터 건수</li>
          <li>sort: 정렬 조건</li>
        </ul>
      </li>
      <li>예시 url: <code class="language-plaintext highlighter-rouge">/members?page=0&amp;size=20&amp;sort=name,desc&amp;sort=address.city</code></li>
    </ul>
  </li>
</ul>

<details>
<summary style="color:rgb(200, 50, 50)"><b>코드</b></summary>
<div>

    <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"/members"</span><span class="o">,</span> <span class="n">method</span> <span class="o">=</span> <span class="nc">RequestMethod</span><span class="o">.</span><span class="na">GET</span><span class="o">)</span>
<span class="c1">// 파라미터로 Pageable을 받음</span>
<span class="kd">public</span> <span class="nc">String</span> <span class="nf">list</span><span class="o">(</span><span class="nc">Pageable</span> <span class="n">pageable</span><span class="o">,</span> <span class="nc">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
  <span class="nc">Page</span><span class="o">&lt;</span><span class="nc">Member</span><span class="o">&gt;</span> <span class="n">page</span> <span class="o">=</span> <span class="n">memberService</span><span class="o">.</span><span class="na">findMembers</span><span class="o">(</span><span class="n">pageable</span><span class="o">);</span>
  <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">"members"</span><span class="o">,</span> <span class="n">page</span><span class="o">.</span><span class="na">getContent</span><span class="o">());</span>
  <span class="k">return</span> <span class="s">"memgbers/memberList"</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div>    </div>

  </div>
</details>

<p><br /></p>

<h3 id="접두사">접두사</h3>
<ul>
  <li>페이징 정보 둘 이상이면 접두사로 구분</li>
  <li>접두사는 <code class="language-plaintext highlighter-rouge">@Qualifier</code> 어노테이션 사용</li>
  <li>{접두사명}_{요청 파라미터} 형태로 구분</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// 예시: /members?member_page=0&amp;order_page=1</span>
<span class="kd">public</span> <span class="nc">String</span> <span class="nf">list</span><span class="o">(</span>
  <span class="nd">@Quailfier</span><span class="o">(</span><span class="s">"member"</span><span class="o">)</span> <span class="nc">Pageable</span> <span class="n">memberPageable</span><span class="o">,</span>
  <span class="nd">@Quailfier</span><span class="o">(</span><span class="s">"order"</span><span class="o">)</span> <span class="nc">Pageable</span> <span class="n">orderPageable</span>
<span class="o">)</span> <span class="o">{</span>
  <span class="o">...</span>
<span class="o">}</span>
</code></pre></div></div>

<p><br /></p>

<h3 id="기본값">기본값</h3>
<ul>
  <li>Pageable의 기본값은 page=0, size=20</li>
  <li>변경하려면 <code class="language-plaintext highlighter-rouge">@PageableDefault</code> 어노테이션 사용</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"/mebers_page"</span><span class="o">,</span> <span class="n">method</span><span class="o">=</span><span class="nc">RequestMethod</span><span class="o">.</span><span class="na">GET</span><span class="o">)</span>
<span class="kd">public</span> <span class="nc">String</span> <span class="nf">list</span><span class="o">(</span><span class="nd">@PageableDefault</span><span class="o">(</span><span class="n">size</span> <span class="o">=</span> <span class="mi">12</span><span class="o">,</span> <span class="n">sort</span> <span class="o">=</span> <span class="s">"name"</span><span class="o">,</span> <span class="n">direction</span> <span class="o">=</span> <span class="nc">Sort</span><span class="o">.</span><span class="na">Direction</span><span class="o">.</span><span class="na">DESC</span><span class="o">)</span> <span class="nc">Pageable</span> <span class="n">pageable</span> <span class="o">)</span> <span class="o">{</span>
  <span class="o">...</span>
<span class="o">}</span>
</code></pre></div></div>

<p><br />
<br />
<br /></p>

<h1 id="128-스프링-데이터-jpa가-사용하는-구현체">12.8 스프링 데이터 JPA가 사용하는 구현체</h1>
<ul>
  <li>스프링 데이터 JPA 공통 인터페이스는 <code class="language-plaintext highlighter-rouge">org.springframework.data.jpa.repository.support.SinmpleJpaRepository</code> 클래스가 구현</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// SimpleJpaRepository</span>
<span class="nd">@Repository</span> <span class="c1">// JPA 예외를 스프링이 추상화한 예외로 변환함</span>
<span class="nd">@Transactional</span><span class="o">(</span><span class="n">readOnly</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span> <span class="c1">// 데이터를 조회하는 메소드에서는 readOnly = true. 데이터 변경하지 않는 트랜잭션에서 이 옵션 쓰면 플러시 생략해서 성능 향상됨</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SimpleJpaRepository</span><span class="o">&lt;</span><span class="no">T</span><span class="o">,</span> <span class="no">ID</span> <span class="kd">extends</span> <span class="nc">Serializable</span><span class="o">&gt;</span> <span class="kd">implements</span> <span class="nc">JpaRepository</span><span class="o">&lt;</span><span class="no">T</span><span class="o">,</span> <span class="no">ID</span><span class="o">&gt;,</span> <span class="nc">JpaSpecificationExecutor</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="o">{</span>

  <span class="c1">// 데이터 등록, 수정, 삭제하는 메소드에 트랜잭션 처리 되어있음 </span>
  <span class="c1">// 따라서 서비스 레이어에서 트랜잭션 시작 안했으면 레포지토리에서 시작함</span>
  <span class="c1">// 서비스 레이어에서 시작 했으면 레포지토리는 전파받아서 그대로 사용</span>
  <span class="nd">@Transactional</span>
  <span class="kd">public</span> <span class="o">&lt;</span><span class="no">S</span> <span class="kd">extends</span> <span class="no">T</span><span class="o">&gt;</span> <span class="no">S</span> <span class="nf">save</span><span class="o">(</span><span class="no">S</span> <span class="n">entity</span><span class="o">)</span> <span class="o">{</span>

    <span class="c1">// entity의 식별자로 새로운 엔티티인지 기존에 있던건지 판별</span>
    <span class="c1">// entity가 객체이면 null 일때, 자바 기본 타입이면 0 일때 새로운 엔티티로 판단</span>
    <span class="c1">// Persistable 인터페이스 구현해서 isNew 로직 변경할 수 있음</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">entityInformation</span><span class="o">.</span><span class="na">isNew</span><span class="o">(</span><span class="n">entity</span><span class="o">))</span> <span class="o">{</span>

      <span class="c1">// 새로운 엔티티면 persist</span>
      <span class="n">em</span><span class="o">.</span><span class="na">persist</span><span class="o">(</span><span class="n">entity</span><span class="o">);</span>
      <span class="k">return</span> <span class="n">entity</span><span class="o">;</span>
    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>

      <span class="c1">// 이미 있는거면 merge</span>
      <span class="k">return</span> <span class="n">em</span><span class="o">.</span><span class="na">merge</span><span class="o">(</span><span class="n">entity</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span>

  <span class="o">...</span>

<span class="o">}</span>
</code></pre></div></div>

<p><br />
<br />
<br /></p>

<h1 id="1210-스프링-데이터-jpa와-querydsl-통합">12.10 스프링 데이터 JPA와 QueryDSL 통합</h1>
<ul>
  <li>스프링 데이터 JPA에선 아래 2가지로 QueryDSL 지원
    <ul>
      <li><code class="language-plaintext highlighter-rouge">org.springframework.data.queryDsl.QueryDslPredicateExecutor</code></li>
      <li><code class="language-plaintext highlighter-rouge">org.springframework.data.queryDsl.QueryDslRepositorySupport</code></li>
    </ul>
  </li>
</ul>

<p><br />
<br /></p>

<h2 id="12101-querydslpredicateexecutor-사용">12.10.1 QueryDslPredicateExecutor 사용</h2>
<ul>
  <li>레포지토리에서 <code class="language-plaintext highlighter-rouge">QueryDslPredicateExecutor</code> 상속하면 레포지토리에서 QueryDSL 사용 가능</li>
  <li>QueryDSL을 검색 조건으로 사용하며 스프링 데이터 JPA의 페이징과 정렬 기능도 함께 사용 가능</li>
  <li><code class="language-plaintext highlighter-rouge">join</code>, <code class="language-plaintext highlighter-rouge">fetch</code> 는 사용 불가
    <ul>
      <li>JPQL에서의 묵시적 조인은 가능</li>
    </ul>
  </li>
  <li>QueryDSL 기능 다 쓰려면 <code class="language-plaintext highlighter-rouge">JPAQuery</code> 직접 쓰거나 <code class="language-plaintext highlighter-rouge">QueryDslRepositorySupport</code> 사용해야 함</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// QueryDslPredicateExecutor 상속</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">ItemRepository</span> <span class="kd">extends</span> <span class="nc">JpaRepository</span><span class="o">&lt;</span><span class="nc">Item</span><span class="o">,</span> <span class="nc">Long</span><span class="o">&gt;,</span> <span class="nc">QueryDslPredicateExecutor</span><span class="o">&lt;</span><span class="nc">Item</span><span class="o">&gt;</span> <span class="o">{</span>

  <span class="o">...</span>

  <span class="c1">// QueryDSL 사용 예제</span>
  <span class="kd">public</span> <span class="nc">Iterable</span><span class="o">&lt;</span><span class="nc">Item</span><span class="o">&gt;</span> <span class="nf">getAllToysPriceOver10000Under20000</span><span class="o">()</span> <span class="o">{</span>
    <span class="nc">QItem</span> <span class="n">item</span> <span class="o">=</span> <span class="nc">QItem</span><span class="o">.</span><span class="na">item</span><span class="o">;</span>
    <span class="nc">Iterable</span><span class="o">&lt;</span><span class="nc">Item</span><span class="o">&gt;</span> <span class="n">result</span> <span class="o">=</span> <span class="n">itemRepository</span><span class="o">.</span><span class="na">findAll</span><span class="o">(</span>
      <span class="n">item</span><span class="o">.</span><span class="na">name</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="s">"toy"</span><span class="o">).</span><span class="na">and</span><span class="o">(</span><span class="n">item</span><span class="o">.</span><span class="na">price</span><span class="o">.</span><span class="na">between</span><span class="o">(</span><span class="mi">10000</span><span class="o">,</span> <span class="mi">20000</span><span class="o">))</span>
    <span class="o">);</span>
  <span class="o">}</span>
  <span class="o">...</span>
<span class="o">}</span>
</code></pre></div></div>

<p><br />
<br /></p>

<h2 id="12102-querydslrepositorysupport-사용">12.10.2 QueryDslRepositorySupport 사용</h2>
<ul>
  <li>QueryDSL 모든 기능 쓰려면 <code class="language-plaintext highlighter-rouge">JPAQuery</code> 객체 직접 생성해서 사용해야 함
    <ul>
      <li><code class="language-plaintext highlighter-rouge">QueryDslRepositorySupport</code> 상속받으면 좀더 편리하게 QueryDSL 사용 가능</li>
    </ul>
  </li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// 사용자 정의 레포지토리</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">CustomOrderRepository</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Order</span><span class="o">&gt;</span> <span class="nf">search</span><span class="o">(</span><span class="nc">OrderSearch</span> <span class="n">orderSearch</span><span class="o">);</span>
<span class="o">}</span>

<span class="o">...</span>

<span class="c1">// 사용자 정의 레포지토리 구현 및 QueryDslRepostiroySupport 상속 예시</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">OrderRepositoryImpl</span> <span class="kd">extends</span> <span class="nc">QueryDslRepositorySupport</span> <span class="kd">implements</span> <span class="nc">CustomOrderRepository</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="nf">OrderRepositoryImpl</span><span class="o">()</span> <span class="o">{</span>
    <span class="kd">super</span><span class="o">(</span><span class="nc">Order</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Order</span><span class="o">&gt;</span> <span class="nf">search</span><span class="o">(</span><span class="nc">OrderSearch</span> <span class="n">orderSearch</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">QOrder</span> <span class="n">order</span> <span class="o">=</span> <span class="nc">QOrder</span><span class="o">.</span><span class="na">order</span><span class="o">;</span>
    <span class="nc">QMember</span> <span class="n">member</span> <span class="o">=</span> <span class="nc">QMember</span><span class="o">.</span><span class="na">member</span><span class="o">;</span>

    <span class="nc">JPQLQuery</span> <span class="n">query</span> <span class="o">=</span> <span class="n">from</span><span class="o">(</span><span class="n">order</span><span class="o">);</span>

    <span class="k">if</span> <span class="o">(</span><span class="nc">StringUtils</span><span class="o">.</span><span class="na">hasText</span><span class="o">(</span><span class="n">orderSearch</span><span class="o">.</span><span class="na">getMemberName</span><span class="o">()))</span> <span class="o">{</span>
      <span class="n">query</span>
        <span class="o">.</span><span class="na">leftJoin</span><span class="o">(</span><span class="n">order</span><span class="o">.</span><span class="na">member</span><span class="o">,</span> <span class="n">member</span><span class="o">)</span>
        <span class="o">.</span><span class="na">where</span><span class="o">(</span><span class="n">member</span><span class="o">.</span><span class="na">name</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="n">orderSearch</span><span class="o">.</span><span class="na">getMemberName</span><span class="o">()));</span>
    <span class="o">}</span>

    <span class="k">if</span> <span class="o">(</span><span class="n">orderSearch</span><span class="o">.</span><span class="na">getOrderStatus</span><span class="o">()</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">query</span>
        <span class="o">.</span><span class="na">where</span><span class="o">(</span><span class="n">order</span><span class="o">.</span><span class="na">status</span><span class="o">.</span><span class="na">eq</span><span class="o">(</span><span class="n">orderSearch</span><span class="o">.</span><span class="na">getOrderStatus</span><span class="o">()));</span>
    <span class="o">}</span>

    <span class="k">return</span> <span class="n">query</span><span class="o">.</span><span class="na">list</span><span class="o">(</span><span class="n">order</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

</article>



<section class="tags">
  <strong>Tags:</strong> <a href="/tag/jpa">jpa</a>,&nbsp;<a href="/tag/spring-data-jpa">spring-data-jpa</a>,&nbsp;<a href="/tag/spring">spring</a>,&nbsp;<a href="/tag/data">data</a>,&nbsp;<a href="/tag/interface">interface</a>,&nbsp;<a href="/tag/query-method">query-method</a>,&nbsp;<a href="/tag/query">query</a>,&nbsp;<a href="/tag/method">method</a>,&nbsp;<a href="/tag/repository">repository</a>,&nbsp;<a href="/tag/web">web</a>,&nbsp;<a href="/tag/query-dsl">query-dsl</a>
</section>



<section class="rss">
  <p class="rss-subscribe text"><strong>Subscribe <a href="/feed.xml">via RSS</a></strong></p>
</section>

<section class="share">
  <span>Share: </span>
  
    
    
      <a href="//twitter.com/share?text=%5B%EC%9E%90%EB%B0%94+ORM+%ED%91%9C%EC%A4%80+JPA+%ED%94%84%EB%A1%9C%EA%B7%B8%EB%9E%98%EB%B0%8D%5D+12%EC%9E%A5.+%EC%8A%A4%ED%94%84%EB%A7%81+%EB%8D%B0%EC%9D%B4%ED%84%B0+JPA&url=https%3A%2F%2Fsungunjo.github.io%2Fjpa-study%2F2022%2F03%2F22%2Fch.12-spring-data-jpa.html&via="
        onclick="window.open(this.href, 'twitter-share', 'width=550,height=255');return false;">
        <i class="fa fa-twitter-square fa-lg"></i>
      </a>
    
    
    
    
    
    
    
  
    
    
    
      <a href="//www.facebook.com/sharer.php?t=%5B%EC%9E%90%EB%B0%94+ORM+%ED%91%9C%EC%A4%80+JPA+%ED%94%84%EB%A1%9C%EA%B7%B8%EB%9E%98%EB%B0%8D%5D+12%EC%9E%A5.+%EC%8A%A4%ED%94%84%EB%A7%81+%EB%8D%B0%EC%9D%B4%ED%84%B0+JPA&u=https%3A%2F%2Fsungunjo.github.io%2Fjpa-study%2F2022%2F03%2F22%2Fch.12-spring-data-jpa.html"
        onclick="window.open(this.href, 'facebook-share', 'width=550,height=255');return false;">
        <i class="fa fa-facebook-square fa-lg"></i>
      </a>
    
    
    
    
    
    
  
    
    
    
    
    
    
    
    
  
    
    
    
    
    
      <a href="//www.linkedin.com/shareArticle?mini=true&url=https%3A%2F%2Fsungunjo.github.io%2Fjpa-study%2F2022%2F03%2F22%2Fch.12-spring-data-jpa.html"
        onclick="window.open(this.href, 'linkedin-share', 'width=550,height=255');return false;">
        <i class="fa fa-linkedin-square fa-lg"></i>
      </a>
    
    
    
    
  
    
    
    
    
      <a href="//plus.google.com/share?title=%5B%EC%9E%90%EB%B0%94+ORM+%ED%91%9C%EC%A4%80+JPA+%ED%94%84%EB%A1%9C%EA%B7%B8%EB%9E%98%EB%B0%8D%5D+12%EC%9E%A5.+%EC%8A%A4%ED%94%84%EB%A7%81+%EB%8D%B0%EC%9D%B4%ED%84%B0+JPA&url=https%3A%2F%2Fsungunjo.github.io%2Fjpa-study%2F2022%2F03%2F22%2Fch.12-spring-data-jpa.html"
        onclick="window.open(this.href, 'google-plus-share', 'width=550,height=255');return false;">
        <i class="fa fa-google-plus-square fa-lg"></i>
      </a>
    
    
    
    
    
  
    
    
    
    
    
    
    
    
  
    
    
    
    
    
    
    
    
  
    
    
    
    
    
    
      <a href="//www.pinterest.com/pin/create/button/?description=%5B%EC%9E%90%EB%B0%94+ORM+%ED%91%9C%EC%A4%80+JPA+%ED%94%84%EB%A1%9C%EA%B7%B8%EB%9E%98%EB%B0%8D%5D+12%EC%9E%A5.+%EC%8A%A4%ED%94%84%EB%A7%81+%EB%8D%B0%EC%9D%B4%ED%84%B0+JPA&url=https%3A%2F%2Fsungunjo.github.io%2Fjpa-study%2F2022%2F03%2F22%2Fch.12-spring-data-jpa.html&media=https://sungunjo.github.io/assets/instacode.png"
        onclick="window.open(this.href, 'pinterest-share', 'width=550,height=255');return false;">
        <i class="fa fa-pinterest-square fa-lg"></i>
      </a>
    
    
    
  
    
    
    
    
    
    
    
    
  
    
    
    
    
    
    
    
    
  
    
    
    
    
    
    
    
    
  
    
    
    
    
    
    
    
    
  
    
    
    
    
    
    
    
    
  
    
    
    
    
    
    
    
    
  
    
    
    
    
    
    
    
      <a href="//www.reddit.com/submit" onclick="window.location = '//www.reddit.com/submit?url=' + encodeURIComponent('https://sungunjo.github.io/jpa-study/2022/03/22/ch.12-spring-data-jpa.html') + '&title=[자바 ORM 표준 JPA 프로그래밍] 12장. 스프링 데이터 JPA'; return false">
        <i class="fa fa-reddit-square fa-lg"></i>
      </a>
    
    
  
    
    
    
    
    
    
    
    
  
</section>




<section class="disqus">
  <div id="disqus_thread"></div>
  <script type="text/javascript">
    var disqus_shortname = 'sungunjo-github-io';

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</section>



</div>
</div>

    </div>

    <footer class="site-footer">

  <div class="wrapper">

    <h3 class="footer-heading">Development Stash</h3>

    <div class="site-navigation">

      <p><strong>Site Map</strong></p>
      <ul class="pages">
				
	
	<li class="nav-link"><a href="/about/">About</a>
	

	

	

	
	<li class="nav-link"><a href="/posts/">Posts</a>
	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	


      </ul>
    </div>

    <div class="site-contact">

      <p><strong>Contact</strong></p>
      <ul class="social-media-list">
        <li>
          <a href="mailto:sungunjo.dev@gmail.com">
            <i class="fa fa-envelope-o"></i>
            <span class="username">sungunjo.dev@gmail.com</span>
          </a>
        </li>

        
          
        
          
        
          
          <li>
            <a href="https://github.com/sungunjo" title="Fork me on GitHub">
              <i class="fa fa-github"></i>
              <span class="username">sungunjo</span>
            </a>
          </li>
          
        
          
          <li>
            <a href="https://www.linkedin.com/in/sungunjo" title="Connect with me on LinkedIn">
              <i class="fa fa-linkedin"></i>
              <span class="username">SungUn Jo</span>
            </a>
          </li>
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        

      </ul>
    </div>

    <div class="site-signature">
      <p class="rss-subscribe text"><strong>Subscribe <a href="/feed.xml">via RSS</a></strong></p>
      <p class="text">개발 공부 블로그</p>
    </div>

  </div>

</footer>

<!-- Scripts -->
<script src="//code.jquery.com/jquery-3.4.1.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/highlight.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/lightbox2/2.11.1/js/lightbox.min.js"></script>
<script src="//unpkg.com/popper.js@1"></script>
<script src="//unpkg.com/tippy.js@5"></script>

<script type="text/javascript">
$(document).ready(function() {
  // Default syntax highlighting
  hljs.initHighlightingOnLoad();

  // Header
  var menuToggle = $('#js-mobile-menu').unbind();
  $('#js-navigation-menu').removeClass("show");
  menuToggle.on('click', function(e) {
    e.preventDefault();
    $('#js-navigation-menu').slideToggle(function(){
      if($('#js-navigation-menu').is(':hidden')) {
        $('#js-navigation-menu').removeAttr('style');
      }
    });
  });

	// Enable tooltips via Tippy.js
	if (Array.isArray(window.tooltips)) {
		window.tooltips.forEach(function(tooltip) {
			var selector = tooltip[0];
			var config = tooltip[1];
			tippy(selector, config);
		})
	}
});

</script>




<!-- Google Analytics -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-156645046-1', 'auto');
  ga('send', 'pageview', {
    'page': '/jpa-study/2022/03/22/ch.12-spring-data-jpa.html',
    'title': '[자바 ORM 표준 JPA 프로그래밍] 12장. 스프링 데이터 JPA'
  });
</script>



  </body>

</html>
