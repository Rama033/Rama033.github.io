<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>[자바 ORM 표준 JPA 프로그래밍] 7장. 고급 매핑</title>
  <meta name="description" content="7장. 고급 매핑">
  
  <meta name="author" content="Jo">
  <meta name="copyright" content="&copy; Jo 2022">
  

  <!-- External libraries -->
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css">
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/styles/monokai-sublime.min.css">
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/lightbox2/2.7.1/css/lightbox.css">

  <!-- Favicon and other icons (made with http://www.favicon-generator.org/) -->
  <link rel="shortcut icon" href="/assets/icons/favicon.ico" type="image/x-icon">
  <link rel="icon" href="/assets/icons/favicon.ico" type="image/x-icon">
  <link rel="apple-touch-icon" sizes="57x57" href="/assets/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/assets/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/assets/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/assets/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/assets/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/assets/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/assets/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/assets/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/assets/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192"  href="/assets/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/assets/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/assets/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/assets/icons/favicon-16x16.png">
  <link rel="manifest" href="/assets/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/assets/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">

  
  <!-- Facebook OGP cards -->
  <meta property="og:description" content="7장. 고급 매핑" />
  <meta property="og:url" content="https://sungunjo.github.io/jpa-study/2022/02/05/ch.7-advanced-mapping.html">
  <meta property="og:site_name" content="Development Stash" />
  <meta property="og:title" content="[자바 ORM 표준 JPA 프로그래밍] 7장. 고급 매핑" />
  <meta property="og:type" content="website" />
  <meta property="og:image" content="https://sungunjo.github.io/assets/instacode.png" />
  <meta property="og:image:type" content="image/png" />
  <meta property="og:image:width" content="612" />
  <meta property="og:image:height" content="605" />
  

  
  <!-- Twitter: card tags -->
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="[자바 ORM 표준 JPA 프로그래밍] 7장. 고급 매핑">
  <meta name="twitter:description" content="7장. 고급 매핑">
  <meta name="twitter:image" content="https://sungunjo.github.io/assets/instacode.png">
  <meta name="twitter:url" content="https://sungunjo.github.io/jpa-study/2022/02/05/ch.7-advanced-mapping.html">
  

  

  <!-- Site styles -->
  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="https://sungunjo.github.io/jpa-study/2022/02/05/ch.7-advanced-mapping.html">
	<link rel="alternate" type="application/rss+xml" title="Development Stash" href="https://sungunjo.github.io/feed.xml" />
	
	<!-- Tooltips -->
	<script type="text/javascript">
		window.tooltips = []
	</script>
</head>


  <body>

    <header class="navigation" role="banner">
  <div class="navigation-wrapper">
    <a href="/" class="logo">
      
      <img src="/assets/logo.png" alt="Development Stash">
      
    </a>
    <a href="javascript:void(0)" class="navigation-menu-button" id="js-mobile-menu">
      <i class="fa fa-bars"></i>
    </a>
    <nav role="navigation">
      <ul id="js-navigation-menu" class="navigation-menu show">
				
	
	<li class="nav-link"><a href="/about/">About</a>
	

	

	

	
	<li class="nav-link"><a href="/posts/">Posts</a>
	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	


      </ul>
    </nav>
  </div>
</header>


    <div class="page-content">
        <div class="post">

<div class="post-header-container has-cover" style="background-image: url(/assets/instacode.png);">
  <div class="scrim has-cover">
    <header class="post-header">
      <h1 class="title">[자바 ORM 표준 JPA 프로그래밍] 7장. 고급 매핑</h1>
      <p class="info">by <strong>Jo</strong></p>
    </header>
  </div>
</div>

<div class="wrapper">



<section class="post-meta">
  <div class="post-date">February 5, 2022</div>
  <div class="post-categories">
  in 
    
    <a href="/category/jpa-study">Jpa-study</a>
    
  
  </div>
</section>

<article class="post-content">
  <h1 id="7장-고급-매핑">7장. 고급 매핑</h1>

<h1 id="71-상속-관계-매핑">7.1 상속 관계 매핑</h1>

<ul>
  <li>관계형 DB에는 상속이라는 개념 X</li>
  <li>ORM 에서 얘기하는 상속 관계 매핑은 <strong>객체의 상속구조</strong>와 <strong>DB의 슈퍼타입 서브타입 관계</strong>를 매핑하는 것</li>
</ul>

<p><img src="/assets/img/jpa_study/ch.7/pic-7-1.png" /></p>

<ul>
  <li>슈퍼타입 서브타입 논리 모델을 실제 물리 모델인 테이블로 구현시 아래와 같은 3가지 방법중 선택 가능
    <ul>
      <li><strong>각각의 테이블로 변환:</strong> 각각을 모두 테이블로 만들고 조회할 때 조인을 사용. =&gt; <strong>조인 전략</strong></li>
      <li><strong>통합 테이블로 변환:</strong> 테이블을 하나만 사용해서 통합. =&gt; <strong>단일 테이블 전략</strong></li>
      <li><strong>서브타입 테이블로 변환:</strong> 서브타입마다 하나의 테이블을 만듬. =&gt; <strong>구현 클래스마다 테이블 전략</strong></li>
    </ul>
  </li>
</ul>

<p><br />
<br /></p>

<h2 id="711-조인-전략">7.1.1 조인 전략</h2>
<p><img src="/assets/img/jpa_study/ch.7/pic-7-2.png" /></p>

<ul>
  <li>엔티티 각각을 모두 테이블로 만들고 자식 테이블이 부모 테이블의 pk 를 pk &amp; fk 로 사용</li>
  <li>∴ 조회 시 조인을 자주 사용</li>
  <li><strong>!!주의사항!!:</strong> 객체는 타입으로 구분할 수 있지만 테이블엔 타입 개념이 없으므로 타입 구분 컬럼 필요함
    <ul>
      <li>위 예제의 경우 dtype column 이 타입 구분용 컬럼</li>
    </ul>
  </li>
</ul>

<details>
<summary style="color:rgb(200, 50, 50)"><b>코드</b></summary>
<div>

    <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Entity</span>
<span class="nd">@Inheritance</span><span class="o">(</span><span class="n">strategy</span> <span class="o">=</span> <span class="nc">InheritanceType</span><span class="o">.</span><span class="na">JOINED</span><span class="o">)</span>
<span class="nd">@DiscriminatorColumn</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"dtype"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">Item</span> <span class="o">{</span>
    <span class="nd">@Id</span>
    <span class="nd">@GeneratedValue</span>
    <span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

    <span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">price</span><span class="o">;</span>

    <span class="o">...</span>
<span class="o">}</span>

<span class="o">...</span>

<span class="nd">@Entity</span>
<span class="nd">@DiscriminatorValue</span><span class="o">(</span><span class="s">"A"</span><span class="o">)</span>
<span class="nd">@PrimaryKeyJoinColumn</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"item_id"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Albumn</span> <span class="kd">extends</span> <span class="nc">Item</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">artist</span><span class="o">;</span>

    <span class="o">...</span>
<span class="o">}</span>

<span class="o">...</span>

<span class="nd">@Entity</span>
<span class="nd">@DiscriminatorValue</span><span class="o">(</span><span class="s">"M"</span><span class="o">)</span>
<span class="nd">@PrimaryKeyJoinColumn</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"item_id"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Movie</span> <span class="kd">extends</span> <span class="nc">Item</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">director</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">actor</span><span class="o">;</span>

    <span class="o">...</span>
<span class="o">}</span>

<span class="o">...</span>

<span class="nd">@Entity</span>
<span class="nd">@DiscriminatorValue</span><span class="o">(</span><span class="s">"B"</span><span class="o">)</span>
<span class="nd">@PrimaryKeyJoinColumn</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"item_id"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Book</span> <span class="kd">extends</span> <span class="nc">Item</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">author</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">isbn</span><span class="o">;</span>

    <span class="o">...</span>
<span class="o">}</span>

</code></pre></div>    </div>

  </div>
</details>
<ul>
  <li><strong>@Inheritance(strategy = InheritanceType.JOINED):</strong> 상속 매핑시 부모 클래스에 @Inheritance 사용해야 함
    <ul>
      <li>또한 매핑 전략 지정해줘야 하는데 위 예제에서는 조인 전략을 사용하기 위해 InheritanceType.JOINED 설정</li>
    </ul>
  </li>
  <li><strong>@DiscriminatorColumn(name = “dtype”):</strong> 부모 클래스에 구분 컬럼을 지정
    <ul>
      <li>기본 값은 DTYPE</li>
    </ul>
  </li>
  <li><strong>@DiscriminatorValue(“M”):</strong> 엔티티 저장시 구분 컬럼에 입력할 값을 지정
    <ul>
      <li>여기 설정한 값이 구분 컬럼(위 예제에선 dtype) 에 저장됨</li>
    </ul>
  </li>
  <li><strong>@PrimaryKeyJoinColumn(“item_id”):</strong> 자식 테이블의 pk 컬럼명 변경하기 위해 사용
    <ul>
      <li>기본 값으로는 부모 테이블의 id 컬럼명을 그대로 사용</li>
    </ul>
  </li>
</ul>

<p><br /></p>

<h3 id="조인전략-장단점-및-특징">조인전략 장/단점 및 특징</h3>
<ul>
  <li>장점:
    <ul>
      <li>테이블이 정규화 됨</li>
      <li>fk 참조 무결성 제약조건 활용 가능</li>
      <li>저장공간 효율적으로 사용</li>
    </ul>
  </li>
  <li>단점:
    <ul>
      <li>조회시 조인이 많이 사용되어 성능 저하될 수 있음</li>
      <li>조회 쿼리가 복잡</li>
      <li>데이터 등록시 INSERT 쿼리 두번 실행됨</li>
    </ul>
  </li>
  <li>특징:
    <ul>
      <li>JPA 표준 명세는 구분 컬럼 사용하도록 하지만 하이버네이트를 비롯한 몇 구현체는 구분 컬럼 없이도 동작함</li>
    </ul>
  </li>
</ul>

<p><br />
<br /></p>

<h2 id="712-단일-테이블-전략">7.1.2 단일 테이블 전략</h2>
<p><img src="/assets/img/jpa_study/ch.7/pic-7-3.png" /></p>

<ul>
  <li>테이블을 하나만 사용</li>
  <li>구분 컬럼으로 어떤 자식 데이터가 저장되었는지 구분</li>
  <li><strong>!!주의사항!!:</strong> 자식 엔티티가 매핑한 컬럼은 모두 null 사용해야 함
    <ul>
      <li>다른 자식 엔티티와 매핑된 컬럼은 null로 비워둬야 하기 때문</li>
    </ul>
  </li>
</ul>

<details>
<summary style="color:rgb(200, 50, 50)"><b>코드</b></summary>
<div>

    <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Entity</span>
<span class="nd">@Inheritance</span><span class="o">(</span><span class="n">strategy</span> <span class="o">=</span> <span class="nc">InheritanceType</span><span class="o">.</span><span class="na">SINGLE_TABLE</span><span class="o">)</span>
<span class="nd">@DiscriminatorColumn</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"dtype"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">Item</span> <span class="o">{</span>
    <span class="nd">@Id</span>
    <span class="nd">@GeneratedValue</span>
    <span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

    <span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">price</span><span class="o">;</span>

    <span class="o">...</span>
<span class="o">}</span>

<span class="o">...</span>

<span class="nd">@Entity</span>
<span class="nd">@DiscriminatorValue</span><span class="o">(</span><span class="s">"A"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Albumn</span> <span class="kd">extends</span> <span class="nc">Item</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">artist</span><span class="o">;</span>

    <span class="o">...</span>
<span class="o">}</span>

<span class="o">...</span>

<span class="nd">@Entity</span>
<span class="nd">@DiscriminatorValue</span><span class="o">(</span><span class="s">"M"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Movie</span> <span class="kd">extends</span> <span class="nc">Item</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">director</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">actor</span><span class="o">;</span>

    <span class="o">...</span>
<span class="o">}</span>

<span class="o">...</span>

<span class="nd">@Entity</span>
<span class="nd">@DiscriminatorValue</span><span class="o">(</span><span class="s">"B"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Book</span> <span class="kd">extends</span> <span class="nc">Item</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">author</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">isbn</span><span class="o">;</span>

    <span class="o">...</span>
<span class="o">}</span>

</code></pre></div>    </div>

  </div>
</details>

<ul>
  <li><strong>@Inheritance(strategy = InheritanceType.SINGLE_TABLE):</strong> 단일 테이블 전략은 InhertianceType.SINGLE_TABLE 로 설정</li>
  <li>구분 컬럼은 필수</li>
</ul>

<p><br /></p>

<h3 id="단일-테이블-전략-장단점-및-특징">단일 테이블 전략 장/단점 및 특징</h3>
<ul>
  <li>장점:
    <ul>
      <li>조인 필요없어 일반적으로 조회 성능이 빠름</li>
      <li>조회 쿼리가 단순</li>
    </ul>
  </li>
  <li>단점:
    <ul>
      <li>자식 엔티티가 매핑한 컬럼은 모두 null 허용해야 함</li>
      <li>단일 테이블에 다 저장해서 테이블이 커질 수 있음 =&gt; 상황에 따라 조회 성능 더 느려질 수도</li>
    </ul>
  </li>
  <li>특징:
    <ul>
      <li>구분 컬럼 필수. 따라서 <code class="language-plaintext highlighter-rouge">@DiscriminatorColumn</code> 꼭 설정해야 함</li>
      <li><code class="language-plaintext highlighter-rouge">@DiscriminatorValue</code> 지정 안하면 default 값은 엔티티 이름</li>
    </ul>
  </li>
</ul>

<p><br />
<br /></p>

<h2 id="713-구현-클래스마다-테이블-전략-table-per-concrete-class-strategy">7.1.3 구현 클래스마다 테이블 전략 (Table-per-Concrete-Class Strategy)</h2>
<p><img src="/assets/img/jpa_study/ch.7/pic-7-4.png" /></p>

<ul>
  <li>자식 엔티티마다 테이블 만듬</li>
  <li>자식 테이블 각각에 필요한 컬럼 모두 생성</li>
</ul>

<details>
<summary style="color:rgb(200, 50, 50)"><b>코드</b></summary>
<div>

    <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Entity</span>
<span class="nd">@Inheritance</span><span class="o">(</span><span class="n">strategy</span> <span class="o">=</span> <span class="nc">InheritanceType</span><span class="o">.</span><span class="na">TABLE_PER_CLASS</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">Item</span> <span class="o">{</span>
    <span class="nd">@Id</span>
    <span class="nd">@GeneratedValue</span>
    <span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

    <span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">price</span><span class="o">;</span>

    <span class="o">...</span>
<span class="o">}</span>

<span class="o">...</span>

<span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Albumn</span> <span class="kd">extends</span> <span class="nc">Item</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">artist</span><span class="o">;</span>

    <span class="o">...</span>
<span class="o">}</span>

<span class="o">...</span>

<span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Movie</span> <span class="kd">extends</span> <span class="nc">Item</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">director</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">actor</span><span class="o">;</span>

    <span class="o">...</span>
<span class="o">}</span>

<span class="o">...</span>

<span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Book</span> <span class="kd">extends</span> <span class="nc">Item</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">author</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">isbn</span><span class="o">;</span>

    <span class="o">...</span>
<span class="o">}</span>

</code></pre></div>    </div>

  </div>
</details>

<ul>
  <li><strong>@Inheritance(strategy = InheritanceType.TABLE_PER_CLASS):</strong> 구현 클래스마다 테이블 전략은 InheritanceType.TABLE_PER_CLASS 로 설정</li>
</ul>

<p><br /></p>

<h3 id="구현-클래스마다-테이블-전략-장단점-및-특징">구현 클래스마다 테이블 전략 장/단점 및 특징</h3>
<ul>
  <li>장점:
    <ul>
      <li>서브 타입 구분해서 처리시 효과적</li>
      <li>not null 제약조건 사용 가능</li>
    </ul>
  </li>
  <li>단점:
    <ul>
      <li>여러 자식 테이블 함께 조회 시 성능 안좋음(UNION 사용해야 하기 때문)</li>
      <li>자식 테이블 통합해서 쿼리하기 어려움</li>
    </ul>
  </li>
  <li>특징
    <ul>
      <li>구분 컬럼 사용안함</li>
    </ul>
  </li>
</ul>

<p><br />
<br />
<br /></p>

<h1 id="72-mappedsuperclass">7.2 @MappedSuperclass</h1>
<ul>
  <li>부모 클래스는 테이블과 매핑하지 않고 상속받는 자식 클래스에게 매핑 정보만 제공하려면 <code class="language-plaintext highlighter-rouge">@MappedSuperclass</code> 사용</li>
</ul>

<p><img src="/assets/img/jpa_study/ch.7/pic-7-5.png" /></p>

<details>
<summary style="color:rgb(200, 50, 50)"><b>코드</b></summary>
<div>

    <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@MappedSuperclass</span>
<span class="kd">public</span> <span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">BaseEntity</span> <span class="o">{</span>
    <span class="nd">@Id</span>
    <span class="nd">@GeneratedValue</span>
    <span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>

    <span class="o">...</span>
<span class="o">}</span>

<span class="o">...</span>

<span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Member</span> <span class="kd">extends</span> <span class="nc">BaseEntity</span> <span class="o">{</span>
    <span class="c1">// id 상속</span>
    <span class="c1">// name 상속</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">email</span><span class="o">;</span>

    <span class="o">...</span>
<span class="o">}</span>

<span class="o">...</span>

<span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Seler</span> <span class="kd">extends</span> <span class="nc">BaseEntity</span> <span class="o">{</span>
    <span class="c1">// id 상속</span>
    <span class="c1">// name 상속</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">shopName</span><span class="o">;</span>

    <span class="o">...</span>
<span class="o">}</span>

</code></pre></div>    </div>

  </div>
</details>

<ul>
  <li>BaseEntity 에는 객체들이 주로 사용하는 공통 매핑 정보 정의</li>
  <li>자식 엔티티에서 상속으로 BaseEntity의 매핑 정보 물려받음</li>
  <li>BaseEntity 는 테이블과 매핑 X</li>
  <li>상속받은 매핑 정보 재정의 하려면 <code class="language-plaintext highlighter-rouge">@AttributeOverride</code> 또는 <code class="language-plaintext highlighter-rouge">@AttributeOverrides</code> 사용</li>
  <li>연관관계 재정의 하려면 <code class="language-plaintext highlighter-rouge">@AssociationOverride</code> 나 <code class="language-plaintext highlighter-rouge">@AssociationOverrides</code> 사용</li>
</ul>

<details>
<summary style="color:rgb(200, 50, 50)"><b>코드</b></summary>
<div>

    <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Entity</span>
<span class="nd">@AttributeOverride</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"id"</span><span class="o">,</span> <span class="n">column</span> <span class="o">=</span> <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"member_id"</span><span class="o">))</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Member</span> <span class="kd">extends</span> <span class="nc">BaseEntity</span> <span class="o">{</span> <span class="o">...</span> <span class="o">}</span>

</code></pre></div>    </div>

  </div>
</details>

<ul>
  <li>위 예시처럼 <code class="language-plaintext highlighter-rouge">@AttributeOverride</code> 를 써서 상속받은 id 속성 컬럼명을 재정의 할 수 있음</li>
</ul>

<details>
<summary style="color:rgb(200, 50, 50)"><b>코드</b></summary>
<div>

    <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Entity</span>
<span class="nd">@AttributeOverrides</span><span class="o">({</span>
    <span class="nd">@AttributeOverride</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"id"</span><span class="o">,</span> <span class="n">column</span> <span class="o">=</span> <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"member_id"</span><span class="o">)),</span>
    <span class="nd">@AttributeOverride</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"name"</span><span class="o">,</span> <span class="n">column</span> <span class="o">=</span> <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"member_name"</span><span class="o">))</span>
<span class="o">})</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Member</span> <span class="kd">extends</span> <span class="nc">BaseEntity</span> <span class="o">{</span> <span class="o">...</span> <span class="o">}</span>

</code></pre></div>    </div>

  </div>
</details>

<ul>
  <li>둘 이상을 재정의 하려면 <code class="language-plaintext highlighter-rouge">@AttrubuteOverrides</code> 사용</li>
</ul>

<p><br /></p>

<h3 id="mappedsuperclass-특징">@MappedSuperclass 특징</h3>
<ul>
  <li>테이블과 매핑되지 않고 매핑 정보 상속 위해 사용</li>
  <li><code class="language-plaintext highlighter-rouge">@MappedSuperclass</code> 로 지정한 클래스는 엔티티 아니어서 em.find()나 JPQL 에서 사용 불가</li>
  <li>이 클래스를 직접 생성, 사용할 일 거의 없으므로 추상 클래스로 만드는 것이 권장됨</li>
  <li>이걸 사용해서 등록일자, 수정일자, 등록자, 수정자 같은 공통 속성 효과적으로 관리 가능</li>
</ul>

<blockquote>
  <p>@Entity는 @Entity 또는 @MappedSuperclass 로 지정한 클래스만 상속받을 수 있음</p>
</blockquote>

<p><br />
<br />
<br /></p>

<h1 id="73-복합-키와-식별-관계-매핑">7.3 복합 키와 식별 관계 매핑</h1>

<h2 id="731-식별-관계-vs-비식별-관계">7.3.1 식별 관계 vs 비식별 관계</h2>
<ul>
  <li>DB 테이블 사이의 관계는 fk가 pk에 포함되는지 여부에 따라 식별/비식별로 구분</li>
  <li>최근에는 비식별 관계를 주로 사용하고 꼭 필요한 곳에만 식별 관계 사용하는 추세</li>
  <li>JPA 에서는 식별, 비식별 관계 둘 다 지원함</li>
</ul>

<h3 id="식별-관계">식별 관계</h3>

<ul>
  <li>부모 테이블 pk 내려받아 자식 테이블 pk + fk 로 사용하는 관계</li>
</ul>

<p><img src="/assets/img/jpa_study/ch.7/pic-7-6.png" /></p>

<ul>
  <li>예제의 경우 parent 테이블의 pk id 받아서 child 테이블의 pk &amp; fk 로 사용</li>
</ul>

<p><br /></p>

<h3 id="비식별-관계">비식별 관계</h3>
<ul>
  <li>부모 테이블 pk 내려받아 자식 테이블의 fk 로만 사용하는 관계</li>
</ul>

<p><img src="/assets/img/jpa_study/ch.7/pic-7-7.png" /></p>

<ul>
  <li>예제의 경우 parent 테이블의 pk id 받아서 child 테이블의 fk 로만 사용</li>
  <li>
    <table>
      <tbody>
        <tr>
          <td>비식별 관계는 (필수적</td>
          <td>선택적) 비식별 관계로 나뉨</td>
        </tr>
      </tbody>
    </table>
    <ul>
      <li><strong>필수적 비식별 관계(Mandatory):</strong> 외래키 non-null. 연관관계 필수</li>
      <li><strong>선택적 비식별 관계(Optional):</strong> 외래키 nullable. 연관관계 맺을지 여부 선택 가능</li>
    </ul>
  </li>
</ul>

<p><br />
<br /></p>

<h2 id="732-복합키-비식별-관계-매핑">7.3.2 복합키: 비식별 관계 매핑</h2>
<ul>
  <li>ch6에서 나온 것 처럼 JPA에서 복합키 쓰려면 <code class="language-plaintext highlighter-rouge">@IdClass</code> 를 쓰거나 <code class="language-plaintext highlighter-rouge">@EmbeddedId</code> 사용해야 함</li>
  <li>!!아래에 나오는 예제들에서 parent, child 는 객체 상속이랑은 무관함</li>
</ul>

<p><br /></p>

<h3 id="idclass">@IdClass</h3>
<ul>
  <li>관계형 DB에 가까운 방식</li>
</ul>

<p><img src="/assets/img/jpa_study/ch.7/pic-7-8.png" /></p>

<details>
<summary style="color:rgb(200, 50, 50)"><b>코드</b></summary>
<div>

    <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Entity</span>
<span class="nd">@IdClass</span><span class="o">(</span><span class="nc">ParentId</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Parent</span> <span class="o">{</span>
    <span class="nd">@Id</span>
    <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"parent_id1"</span><span class="o">)</span>
    <span class="n">pirvate</span> <span class="nc">Stirng</span> <span class="n">id1</span><span class="o">;</span>     <span class="c1">// ParentId.id1과 연결</span>

    <span class="nd">@Id</span>
    <span class="nd">@Colu</span><span class="o">,</span><span class="n">n</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"parent_id2"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">id2</span><span class="o">;</span>

    <span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>    <span class="c1">// ParentId.id2와 연결</span>

    <span class="o">...</span>
<span class="o">}</span>

<span class="o">...</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ParentId</span> <span class="kd">implements</span> <span class="nc">Serializable</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">id1</span><span class="o">;</span>     <span class="c1">// Parent.id1 매핑</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">id2</span><span class="o">;</span>     <span class="c1">// Parent.id2 매핑</span>

    <span class="kd">public</span> <span class="nf">ParentId</span><span class="o">()</span> <span class="o">{}</span>

    <span class="kd">public</span> <span class="nf">ParentId</span><span class="o">(</span><span class="nc">String</span> <span class="n">id1</span><span class="o">,</span> <span class="nc">String</span> <span class="n">id2</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">id1</span> <span class="o">=</span> <span class="n">id1</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">id2</span> <span class="o">=</span> <span class="n">id2</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">equals</span><span class="o">(</span><span class="nc">Object</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span> <span class="o">...</span> <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">hashCode</span><span class="o">()</span> <span class="o">{</span> <span class="o">...</span> <span class="o">}</span>

    <span class="o">...</span>
<span class="o">}</span>

<span class="o">...</span>

<span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Child</span> <span class="o">{</span>
    <span class="nd">@Id</span>
    <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"child_id"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">id</span><span class="o">;</span>

    <span class="nd">@ManyToOne</span>
    <span class="nd">@JoinColumns</span><span class="o">({</span>
        <span class="nd">@JoinColumn</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"parent_id1"</span><span class="o">,</span>
            <span class="n">referencedColumnName</span> <span class="o">=</span> <span class="s">"parent_id1"</span><span class="o">),</span>   <span class="c1">// name이랑 referencedColumnName 같으면 생략 가능</span>
        <span class="nd">@JoinColumn</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"parent_id2"</span><span class="o">,</span>
            <span class="n">referencedColumnName</span> <span class="o">=</span> <span class="s">"parent_id2"</span><span class="o">)</span>
    <span class="o">})</span>
    <span class="kd">private</span> <span class="nc">Parent</span> <span class="n">parent</span><span class="o">;</span>

    <span class="o">...</span>
<span class="o">}</span>

<span class="o">...</span>

<span class="c1">// 저장</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">save</span><span class="o">()</span> <span class="o">{</span>
    <span class="nc">Parent</span> <span class="n">parent</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Parent</span><span class="o">(</span><span class="s">"myId1"</span><span class="o">,</span> <span class="s">"myId2"</span><span class="o">);</span>
    <span class="n">parent</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="s">"parentName"</span><span class="o">);</span>
    <span class="c1">// ParentId 따로 만들어주지 않아도 em.persist 호출하면 </span>
    <span class="c1">// 영속성 컨텍스트에 엔티티 등록 직전 내부에서 Parent.id1, Parent.id2 값으로 </span>
    <span class="c1">// 식별자 클래스인 ParentId 생성하여 영속성 컨텍스트 키로 사용</span>
    <span class="n">em</span><span class="o">.</span><span class="na">persist</span><span class="o">(</span><span class="n">parent</span><span class="o">);</span>

<span class="o">}</span>

<span class="c1">// 조회</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">find</span><span class="o">()</span> <span class="o">{</span>
    <span class="nc">ParentId</span> <span class="n">parentId</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ParentId</span><span class="o">(</span><span class="s">"myId1"</span><span class="o">,</span> <span class="s">"myId2"</span><span class="o">);</span>
    <span class="nc">Parent</span> <span class="n">parent</span> <span class="o">=</span> <span class="n">em</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="nc">Parent</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">parentId</span><span class="o">);</span>
<span class="o">}</span>

</code></pre></div>    </div>

  </div>
</details>

<ul>
  <li><code class="language-plaintext highlighter-rouge">@IdClass</code> 식별자 클래스의 조건
    <ul>
      <li>식별자 클래스의 속성명과 엔티티에서 사용하는 식별자의 속성명이 같아야 함
        <ul>
          <li>ex) Parent.id1 == ParentId.id1, Parent.id2 == ParentId.id2</li>
        </ul>
      </li>
      <li>Serializable 인터페이스 implements 하고, equals, hashCode override 해야 함</li>
      <li>기본 생성자 있어야 함</li>
      <li>public 이어야 함</li>
    </ul>
  </li>
</ul>

<p><br /></p>

<h3 id="embeddedid">@EmbeddedId</h3>
<ul>
  <li><code class="language-plaintext highlighter-rouge">@IdClass</code> 보다 좀더 객체지향적인 방법</li>
</ul>

<details>
<summary style="color:rgb(200, 50, 50)"><b>코드</b></summary>
<div>

    <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Parent</span> <span class="o">{</span>
    <span class="nd">@EmbeddedId</span>
    <span class="kd">private</span> <span class="nc">ParentId</span> <span class="n">id</span><span class="o">;</span>

    <span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>

    <span class="o">...</span>
<span class="o">}</span>

<span class="o">...</span>

<span class="nd">@Embeddable</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ParentId</span> <span class="kd">implements</span> <span class="nc">Serializable</span> <span class="o">{</span>
    <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"parent_id1"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">id1</span><span class="o">;</span>

    <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"parent_id2"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">id2</span><span class="o">;</span>

    <span class="c1">// equals and hashCode 구현</span>

    <span class="o">...</span>
<span class="o">}</span>

<span class="c1">// 저장</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">save</span><span class="o">()</span> <span class="o">{</span>
    <span class="nc">Parent</span> <span class="n">parent</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Parent</span><span class="o">();</span>
    <span class="nc">ParentId</span> <span class="n">parentId</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ParentId</span><span class="o">(</span><span class="s">"myId1"</span><span class="o">,</span> <span class="s">"myId2"</span><span class="o">);</span>
    <span class="n">parent</span><span class="o">.</span><span class="na">setId</span><span class="o">(</span><span class="n">parentId</span><span class="o">);</span>
    <span class="n">parent</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="s">"parentName"</span><span class="o">);</span>
    <span class="n">em</span><span class="o">.</span><span class="na">persist</span><span class="o">(</span><span class="n">parent</span><span class="o">);</span>
<span class="o">}</span>

<span class="o">...</span>

<span class="c1">// 조회</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">find</span><span class="o">()</span> <span class="o">{</span>
    <span class="nc">ParentId</span> <span class="n">parentId</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ParentId</span><span class="o">(</span><span class="s">"myId1"</span><span class="o">,</span> <span class="s">"myId2"</span><span class="o">);</span>
    <span class="nc">Parent</span> <span class="n">parent</span> <span class="o">=</span> <span class="n">em</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="nc">Parent</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">parentId</span><span class="o">);</span>
<span class="o">}</span>

</code></pre></div>    </div>

  </div>
</details>

<ul>
  <li><code class="language-plaintext highlighter-rouge">@EmbeddedId</code> 사용시 식별자 클래스 조건
    <ul>
      <li><code class="language-plaintext highlighter-rouge">@Embeddable</code> 어노테이션 붙여야 함</li>
      <li>Serializable 인터페이스 구현 및 equals, hashCode 구현</li>
      <li>기본 생성자 있어야 함</li>
      <li>public 이어야 함</li>
    </ul>
  </li>
  <li><code class="language-plaintext highlighter-rouge">@EmbeddedId</code> 사용시에는 식별자 클래스를 직접 쓰고 <code class="language-plaintext highlighter-rouge">@EmbeddedId</code> 어노테이션 붙여주면 됨</li>
  <li>저장 시 <code class="language-plaintext highlighter-rouge">@IdClass</code> 랑 달리 식별자 클래스 직접 생성해서 사용함</li>
</ul>

<blockquote>
  <p>복합키에는 <code class="language-plaintext highlighter-rouge">@GenerateValue</code> 사용 불가. 복합키 구성 요소 컬럼 중 하나에도 X</p>
</blockquote>

<p><br />
<br /></p>

<h2 id="733-복합키-식별-관계-매핑">7.3.3 복합키: 식별 관계 매핑</h2>

<p><img src="/assets/img/jpa_study/ch.7/pic-7-9.png" /></p>

<ul>
  <li>부모 -&gt; 자식 -&gt; 손자 까지 계속 기본키 전달하는 식별관계 예제</li>
  <li>7.3.2와 마찬가지로 <code class="language-plaintext highlighter-rouge">@IdClass</code> 나 <code class="language-plaintext highlighter-rouge">@EmbeddedId</code> 로 식별자 매핑해야 함</li>
</ul>

<p><br /></p>

<h3 id="idclass-와-식별-관계">@IdClass 와 식별 관계</h3>

<details>
<summary style="color:rgb(200, 50, 50)"><b>코드</b></summary>
<div>

    <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Parent</span> <span class="o">{</span>
    <span class="nd">@Id</span>
    <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"parent_id"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">id</span><span class="o">;</span>

    <span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>

    <span class="o">...</span>
<span class="o">}</span>

<span class="o">...</span>

<span class="nd">@Entity</span>
<span class="nd">@IdClass</span><span class="o">(</span><span class="nc">ChildId</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Child</span> <span class="o">{</span>
    <span class="nd">@Id</span>
    <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"child_id"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">childId</span><span class="o">;</span>

    <span class="nd">@Id</span>
    <span class="nd">@ManyToOne</span>
    <span class="nd">@JoinColumn</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"parent_id"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="nc">Parent</span> <span class="n">parent</span><span class="o">;</span>

    <span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>

    <span class="o">...</span>
<span class="o">}</span>

<span class="o">...</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ChildId</span> <span class="kd">implements</span> <span class="nc">Serializable</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">childId</span><span class="o">;</span> <span class="c1">// Child.childId 매핑</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">parent</span><span class="o">;</span>  <span class="c1">// Child.parent 매핑</span>

    <span class="c1">// equals and hashCode</span>

    <span class="o">...</span>
<span class="o">}</span>

<span class="o">...</span>

<span class="nd">@Entity</span>
<span class="nd">@IdClass</span><span class="o">(</span><span class="nc">GrandChildId</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">GrandChild</span> <span class="o">{</span>
    <span class="nd">@Id</span>
    <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"grandchild_id"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">id</span><span class="o">;</span>

    <span class="nd">@Id</span>
    <span class="nd">@ManyToOne</span>
    <span class="nd">@JoinColumns</span><span class="o">({</span>
        <span class="nd">@JoinColumn</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"parent_id"</span><span class="o">),</span>
        <span class="nd">@JoinColumn</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"child_id"</span><span class="o">)</span>
    <span class="o">})</span>
    <span class="kd">private</span> <span class="nc">Child</span> <span class="n">child</span><span class="o">;</span>

    <span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>

    <span class="o">...</span>
<span class="o">}</span>

<span class="o">...</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">GrandChildId</span> <span class="kd">implements</span> <span class="nc">Serializable</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">id</span><span class="o">;</span>          <span class="c1">// GrandChild.id 매핑</span>
    <span class="kd">private</span> <span class="nc">ChildId</span> <span class="n">child</span><span class="o">;</span>    <span class="c1">// GrandChild.child 매핑</span>

    <span class="c1">// equals and hashCode</span>

    <span class="o">...</span>
<span class="o">}</span>

</code></pre></div>    </div>

  </div>
</details>

<ul>
  <li>식별 관계는 pk와 fk 를 같이 매핑해야 함
    <ul>
      <li>∴ 식별자 매핑인 <code class="language-plaintext highlighter-rouge">@Id</code> 와 연관관계 매핑인 <code class="language-plaintext highlighter-rouge">@ManyToOne</code>을 같이 사용하여 동시에 매핑</li>
    </ul>
  </li>
</ul>

<p><br /></p>

<h3 id="embeddedid-와-식별-관계">@EmbeddedId 와 식별 관계</h3>
<ul>
  <li><code class="language-plaintext highlighter-rouge">@EmbeddedId</code>로 식별 관계 구성시에는 <code class="language-plaintext highlighter-rouge">@MapsId</code> 사용해야 함</li>
</ul>

<details>
<summary style="color:rgb(200, 50, 50)"><b>코드</b></summary>
<div>

    <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Parent</span> <span class="o">{</span>
    <span class="nd">@Id</span>
    <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"parent_id"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">id</span><span class="o">;</span>

    <span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>

    <span class="o">...</span>
<span class="o">}</span>

<span class="o">...</span>

<span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Child</span> <span class="o">{</span>
    <span class="nd">@EmbeddedId</span>
    <span class="kd">private</span> <span class="nc">ChildId</span> <span class="n">id</span><span class="o">;</span>

    <span class="nd">@MapsID</span><span class="o">(</span><span class="s">"parentId"</span><span class="o">)</span>
    <span class="nd">@ManyToOne</span>
    <span class="nd">@JoinColumn</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"parent_id"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">Parent</span> <span class="n">parent</span><span class="o">;</span>

    <span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>

    <span class="o">...</span>
<span class="o">}</span>

<span class="o">...</span>

<span class="nd">@Embeddable</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ChildId</span> <span class="kd">implements</span> <span class="nc">Serializable</span> <span class="o">{</span>
    <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"child_id"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">id</span><span class="o">;</span>

    <span class="kd">private</span> <span class="nc">String</span> <span class="n">parentId</span><span class="o">;</span>    <span class="c1">// @MapsId("parentId") 로 매핑</span>

    <span class="c1">// equals and hashCode</span>

    <span class="o">...</span>
<span class="o">}</span>

<span class="o">...</span>

<span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">GrandChild</span> <span class="o">{</span>
    <span class="nd">@EmbeddedId</span>
    <span class="kd">private</span> <span class="nc">GrandChildId</span> <span class="n">id</span><span class="o">;</span>

    <span class="nd">@MapsId</span><span class="o">(</span><span class="s">"childId"</span><span class="o">)</span>      <span class="c1">// GrandChildId.childId 매핑</span>
    <span class="nd">@ManyToOne</span>
    <span class="nd">@JoinColumns</span><span class="o">({</span>
        <span class="nd">@JoinColumn</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"parent_id"</span><span class="o">),</span>
        <span class="nd">@JoinColumn</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"child_id"</span><span class="o">)</span>
    <span class="o">})</span>
    <span class="kd">private</span> <span class="nc">Child</span> <span class="n">child</span><span class="o">;</span>

    <span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>

    <span class="o">...</span>
<span class="o">}</span>

<span class="o">...</span>

<span class="nd">@Embeddable</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">GrandChildId</span> <span class="kd">implements</span> <span class="nc">Serializable</span> <span class="o">{</span>
    <span class="nd">@Column</span><span class="o">(</span><span class="s">"grandchild_id"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">id</span><span class="o">;</span>

    <span class="kd">private</span> <span class="nc">ChildId</span> <span class="n">childId</span><span class="o">;</span>      <span class="c1">// @MapsId("childId") 로 매핑</span>

    <span class="c1">// equals and hashCode</span>

    <span class="o">...</span>
<span class="o">}</span>
</code></pre></div>    </div>

  </div>
</details>

<ul>
  <li><code class="language-plaintext highlighter-rouge">@IdClass</code> 와 달리 <code class="language-plaintext highlighter-rouge">@Id</code>  대신 <code class="language-plaintext highlighter-rouge">@MapsId</code> 를 사용함
    <ul>
      <li><code class="language-plaintext highlighter-rouge">@MapsId</code> 는 fk 와 매핑한 연관관계를 pk 에도 매핑하겠다는 의미</li>
      <li>속성값으로는 <code class="language-plaintext highlighter-rouge">@EmbeddedId</code> 를 사용한 식별자 클래스의 pk 필드 지정하면 됨
        <ul>
          <li>위 예제의 경우 ChildId.parentId 필드</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<p><br />
<br /></p>

<h2 id="734-비식별-관계로-구현">7.3.4 비식별 관계로 구현</h2>

<p><img src="/assets/img/jpa_study/ch.7/pic-7-10.png" /></p>

<details>
<summary style="color:rgb(200, 50, 50)"><b>코드</b></summary>
<div>

    <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Parent</span> <span class="o">{</span>
    <span class="nd">@Id</span>
    <span class="nd">@GeneratedValue</span>
    <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"parent_id"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

    <span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>

    <span class="o">...</span>
<span class="o">}</span>

<span class="o">...</span>

<span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Child</span> <span class="o">{</span>
    <span class="nd">@Id</span>
    <span class="nd">@GeneratedValue</span>
    <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"child_id"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

    <span class="kd">private</span> <span class="nc">Stirng</span> <span class="n">name</span><span class="o">;</span>

    <span class="nd">@ManyToOne</span>
    <span class="nd">@JoinColumn</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"parent_id"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">Parent</span> <span class="n">parent</span><span class="o">;</span>

    <span class="o">...</span>
<span class="o">}</span>

<span class="o">...</span>

<span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">GrandChild</span> <span class="o">{</span>
    <span class="nd">@Id</span>
    <span class="nd">@GenertateValue</span>
    <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"grandchild_id"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>
    
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>

    <span class="nd">@ManyToOne</span>
    <span class="nd">@JoinColumn</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"child_id"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">Child</span> <span class="n">child</span><span class="o">;</span>

    <span class="o">...</span>
<span class="o">}</span>
</code></pre></div>    </div>

  </div>
</details>

<ul>
  <li>식별 관계의 복합 키를 사용한 코드에 비해 훨씬 간단함</li>
</ul>

<p><br />
<br /></p>

<h2 id="735-일대일-식별관계">7.3.5 일대일 식별관계</h2>

<p><img src="/assets/img/jpa_study/ch.7/pic-7-11.png" /></p>

<ul>
  <li>일대일 식별 관계는 부모 테이블 pk 만 자식 테이블의 pk &amp; fk 로 사용하기 때문에 부모 테이블 기본키가 복합키 아니면 복합키로 구성하지 않아도 됨</li>
</ul>

<details>
<summary style="color:rgb(200, 50, 50)"><b>코드</b></summary>
<div>

    <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Board</span> <span class="o">{</span>
    <span class="nd">@Id</span>
    <span class="nd">@GeneratedValue</span>
    <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"board_id"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

    <span class="kd">private</span> <span class="nc">String</span> <span class="n">title</span><span class="o">;</span>

    <span class="nd">@OneToOne</span><span class="o">(</span><span class="n">mappedBy</span> <span class="o">=</span> <span class="s">"board"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">BoardDetail</span> <span class="n">boardDetail</span><span class="o">;</span>

    <span class="o">...</span>
<span class="o">}</span>

<span class="o">...</span>

<span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">BoardDetail</span> <span class="o">{</span>
    <span class="nd">@Id</span>
    <span class="kd">private</span> <span class="nc">Long</span> <span class="n">boardId</span><span class="o">;</span>

    <span class="nd">@MapsId</span>     <span class="c1">// BoardDetail.boardId 매핑</span>
    <span class="nd">@OneToOne</span>
    <span class="nd">@JoinColumn</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"board_id"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">Board</span> <span class="n">board</span><span class="o">;</span>

    <span class="kd">private</span> <span class="nc">String</span> <span class="n">content</span><span class="o">;</span>

    <span class="o">...</span>
<span class="o">}</span>
</code></pre></div>    </div>

  </div>
</details>

<ul>
  <li>BoardDetail처럼 식별자가 단순 컬럼 하나면 <code class="language-plaintext highlighter-rouge">@MapsId</code>사용하고 속성 값 비워두면 됨</li>
</ul>

<p><br />
<br /></p>

<h3 id="736-식별-비식별-관계-장단점">7.3.6 식별, 비식별 관계 장단점</h3>
<ul>
  <li>DB 설계 관점에서는 아래 이유들로 비식별 관계를 선호
    <ul>
      <li>pk 를 자식 테이블로 전파하면서 점점 pk 컬럼 늘어남
        <ul>
          <li>이로 인해 조인 복잡해지고 pk 인덱스 불필요하게 커질 수 있음</li>
        </ul>
      </li>
      <li>2개 이상 컬럼 합해 복합 기본키 만들어야하는 경우가 많음</li>
      <li>기본키로 비즈니스 의미가 있는 자연 키 컬럼 조합하는 경우가 많은데, 이런 건 좋지 않음
        <ul>
          <li>대리키 쓰는게 좋다</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>객체 지향 관점에서는 아래 이유들로 비식별 관계를 선호
    <ul>
      <li>일대일 관계 제외하고는 복합 기본키를 사용하여 매핑 복잡해짐</li>
      <li>비식별 관계를 쓰면 <code class="language-plaintext highlighter-rouge">@GenerateValue</code> 로 대리키 편하게 사용 가능</li>
    </ul>
  </li>
  <li>식별 관계의 장점
    <ul>
      <li>기본 키 인덱스 활용도가 좋고 특정 상황에 조인 없이 하위 테이블 만으로 검색 가능</li>
    </ul>
  </li>
  <li>결론적으로 그냥 비식별 관계 쓰고 대리키 사용하는 게 좋다
    <ul>
      <li>또한 선택적 비식별 보단 필수적 비식별 관계가 항상 관계 있음 보장되어서 inner join 만 해도 돼서 좋다고 함</li>
    </ul>
  </li>
</ul>

<p><br />
<br />
<br /></p>

<h1 id="74-조인-테이블">7.4 조인 테이블</h1>
<ul>
  <li>DB 테이블 연관관계 설계 방식은 다음 2가지
    <ul>
      <li>조인 컬럼 사용(FK)</li>
      <li>조인 테이블 사용(테이블 사용)</li>
    </ul>
  </li>
</ul>

<p><br /></p>

<h3 id="조인-컬럼-사용">조인 컬럼 사용</h3>

<p><img src="/assets/img/jpa_study/ch.7/pic-7-12.png" /></p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">@JoinColumn</code> 으로 매핑</li>
  <li>연관관계를 조인 컬럼(fk 컬럼) 으로 관리</li>
  <li>fk에 null 허용하는 관계 == 선택적 비식별 관계
    <ul>
      <li>이 경우 outer join 써야 함</li>
      <li>연관관계 많지 않으면 null 로 저장되는 경우가 대부분이라는 단점 있음</li>
    </ul>
  </li>
</ul>

<p><br /></p>

<h3 id="조인-테이블연결-테이블-link-table-사용">조인 테이블(=연결 테이블, link table) 사용</h3>

<p><img src="/assets/img/jpa_study/ch.7/pic-7-13.png" /></p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">@JoinTable</code> 로 매핑</li>
  <li>조인 테이블이라는 별도 테이블을 두고 두 테이블의 fk 로 연관관계 관리</li>
  <li>테이블을 하나 추가해야 해서 관리해야 할 것도, 조인할 것도 늘어난 다는 단점 있음</li>
  <li>주로 N:N 을 1:N, N:1 로 풀어내기 위해 사용</li>
</ul>

<p><br />
<br /></p>

<h2 id="741-11-조인-테이블">7.4.1 1:1 조인 테이블</h2>

<p><img src="/assets/img/jpa_study/ch.7/pic-7-14.png" /></p>

<details>
<summary style="color:rgb(200, 50, 50)"><b>코드</b></summary>
<div>

    <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Parent</span> <span class="o">{</span>
    <span class="nd">@Id</span>
    <span class="nd">@GeneratedValue</span>
    <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"parent_id"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

    <span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>

    <span class="nd">@OneToOne</span>
    <span class="nd">@JoinTable</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"parent_child"</span><span class="o">,</span>
        <span class="n">joinColumns</span> <span class="o">=</span> <span class="nd">@JoinColumn</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"parent_id"</span><span class="o">),</span>
        <span class="n">inverseJoinColumns</span> <span class="o">=</span> <span class="nd">@JoinColumn</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"child_id"</span><span class="o">))</span>
    <span class="kd">private</span> <span class="nc">Child</span> <span class="n">child</span><span class="o">;</span>

    <span class="o">...</span>
<span class="o">}</span>

<span class="o">...</span>

<span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Child</span> <span class="o">{</span>
    <span class="nd">@Id</span>
    <span class="nd">@GeneratedValue</span>
    <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"child_id"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

    <span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>

    <span class="kd">private</span> <span class="nc">Parent</span> <span class="n">parent</span><span class="o">;</span>

    <span class="o">...</span>
<span class="o">}</span>
</code></pre></div>    </div>

  </div>
</details>

<ul>
  <li>1:1 조인테이블 단방향 매핑 예제</li>
  <li>
    <p>양방향으로 매핑하려면 Child.parent 위에 <code class="language-plaintext highlighter-rouge">@OneToOne(mappedBy="child")</code> 추가</p>
  </li>
  <li><code class="language-plaintext highlighter-rouge">@JoinTable</code> 속성</li>
</ul>

<table>
  <thead>
    <tr>
      <th style="text-align: center">속성</th>
      <th style="text-align: center">설명</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center">name</td>
      <td style="text-align: center">매핑할 조인 테이블 이름</td>
    </tr>
    <tr>
      <td style="text-align: center">joinColumns</td>
      <td style="text-align: center">현재 엔티티를 참조하는 외래 키</td>
    </tr>
    <tr>
      <td style="text-align: center">inverseJoinColumns</td>
      <td style="text-align: center">반대방향 엔티티를 참조하는 외래 키</td>
    </tr>
  </tbody>
</table>

<p><br />
<br /></p>

<h2 id="742-1n-조인-테이블">7.4.2 1:N 조인 테이블</h2>

<p><img src="/assets/img/jpa_study/ch.7/pic-7-15.png" /></p>

<details>
<summary style="color:rgb(200, 50, 50)"><b>코드</b></summary>
<div>

    <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Parent</span> <span class="o">{</span>
    <span class="nd">@Id</span>
    <span class="nd">@GeneratedValue</span>
    <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"parent_id"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

    <span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>

    <span class="nd">@OneToMany</span>
    <span class="nd">@JoinTable</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"parent_child"</span><span class="o">,</span>
        <span class="n">joinColumns</span> <span class="o">=</span> <span class="nd">@JoinColumn</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"parent_id"</span><span class="o">),</span>
        <span class="n">inverseJoinColumns</span> <span class="o">=</span> <span class="nd">@JoinColumn</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"child_id"</span><span class="o">))</span>
    <span class="kd">private</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Child</span><span class="o">&gt;</span> <span class="n">child</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;</span><span class="nc">Child</span><span class="o">&gt;();</span>

    <span class="o">...</span>
<span class="o">}</span>

<span class="o">...</span>

<span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Child</span> <span class="o">{</span>
    <span class="nd">@Id</span>
    <span class="nd">@GeneratedValue</span>
    <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"child_id"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

    <span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>

    <span class="o">...</span>
<span class="o">}</span>
</code></pre></div>    </div>

  </div>
</details>

<ul>
  <li>1:N 단방향 조인 테이블 매핑 예제</li>
  <li>1:N 관계 만들려면 조인 테이블 컬럼 중 N 쪽 컬럼(위 예제에선 child_id)에 유니크 제약조건 걸어야 함
    <ul>
      <li>예제 child_id 는 pk 라 유니크 제약조건 걸려있음</li>
    </ul>
  </li>
</ul>

<p><br />
<br /></p>

<h2 id="743-n1-조인-테이블">7.4.3 N:1 조인 테이블</h2>

<details>
<summary style="color:rgb(200, 50, 50)"><b>코드</b></summary>
<div>

    <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Parent</span> <span class="o">{</span>
    <span class="nd">@Id</span>
    <span class="nd">@GeneratedValue</span>
    <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"parent_id"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

    <span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>

    <span class="nd">@OneToMany</span><span class="o">(</span><span class="n">mappedBy</span> <span class="o">=</span> <span class="s">"parent"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Child</span><span class="o">&gt;</span> <span class="n">child</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;</span><span class="nc">Child</span><span class="o">&gt;();</span>

    <span class="o">...</span>
<span class="o">}</span>

<span class="o">...</span>

<span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Child</span> <span class="o">{</span>
    <span class="nd">@Id</span>
    <span class="nd">@GeneratedValue</span>
    <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"child_id"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

    <span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>

    <span class="nd">@ManyToOne</span><span class="o">(</span><span class="n">optional</span> <span class="o">=</span> <span class="kc">false</span><span class="o">)</span>
    <span class="nd">@JoinTable</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"parent_child"</span><span class="o">,</span>
        <span class="n">joinColumns</span> <span class="o">=</span> <span class="nd">@JoinColumn</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"child_id"</span><span class="o">),</span>
        <span class="n">inverseJoinColumns</span> <span class="o">=</span> <span class="nd">@JoinColumn</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"parent_id"</span><span class="o">))</span>
    <span class="n">priavte</span> <span class="nc">Parent</span> <span class="n">parent</span><span class="o">;</span>

    <span class="o">...</span>
<span class="o">}</span>
</code></pre></div>    </div>

  </div>
</details>

<ul>
  <li>N:1, 1:N 양방향 조인 테이블 매핑 예제</li>
</ul>

<p><br />
<br /></p>

<h2 id="744-nn-조인-테이블">7.4.4 N:N 조인 테이블</h2>

<p><img src="/assets/img/jpa_study/ch.7/pic-7-16.png" /></p>

<details>
<summary style="color:rgb(200, 50, 50)"><b>코드</b></summary>
<div>

    <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Parent</span> <span class="o">{</span>
    <span class="nd">@Id</span>
    <span class="nd">@GeneratedValue</span>
    <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"parent_id"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

    <span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>

    <span class="nd">@ManyToMany</span>
    <span class="nd">@JoinTable</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"parent_child"</span><span class="o">&lt;</span>
        <span class="n">joinColumns</span> <span class="o">=</span> <span class="nd">@JoinColumn</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"parent_id"</span><span class="o">),</span>
        <span class="n">inverseJoinColumns</span> <span class="o">=</span> <span class="nd">@JoinColumn</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"child_id"</span><span class="o">))</span>
    <span class="kd">private</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Child</span><span class="o">&gt;</span> <span class="n">child</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;</span><span class="nc">Child</span><span class="o">&gt;();</span>

    <span class="o">...</span>
<span class="o">}</span>

<span class="o">...</span>

<span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Child</span> <span class="o">{</span>
    <span class="nd">@Id</span>
    <span class="nd">@GeneratedValue</span>
    <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"child_id"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

    <span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>

    <span class="o">..</span>
<span class="o">}</span>
</code></pre></div>    </div>

  </div>
</details>

<ul>
  <li>N:N 조인 테이블 매핑 예제</li>
  <li>N:N 관계 만들려면 조인 테이블의 두 컬럼 합쳐서 하나의 복합 유니크 제약 걸어야 함
    <ul>
      <li>위 예제의 (parent_id, child_id 는 복합 기본키라 유니크 제약조건 걸려있음)</li>
    </ul>
  </li>
</ul>

<blockquote>
  <p>조인 테이블에 컬럼 추가시 <code class="language-plaintext highlighter-rouge">@JoinTable</code> 전략 사용 불가 <br /> 
엔티티 새로 만들어서 조인 테이블이랑 매핑해야 함</p>
</blockquote>

<p><br />
<br />
<br /></p>

<h1 id="75-엔티티-하나에-여러-테이블-매핑">7.5 엔티티 하나에 여러 테이블 매핑</h1>
<ul>
  <li><code class="language-plaintext highlighter-rouge">@SecondaryTable</code>, <code class="language-plaintext highlighter-rouge">@SecondaryTables</code> 를 사용하여 한 엔티티에 여러 테이블 매핑 가능
    <ul>
      <li>이거로 두 테이블을 하나의 엔티티에 매핑하는 것보다 테이블당 엔티티 만들어서 매핑하는게 더 효율적</li>
      <li>하나에 매핑하면 항상 두 테이블 조회해서 최적화 어려움</li>
    </ul>
  </li>
</ul>

<p><img src="/assets/img/jpa_study/ch.7/pic-7-16.png" /></p>

<details>
<summary style="color:rgb(200, 50, 50)"><b>코드</b></summary>
<div>

    <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Entity</span>
<span class="nd">@Table</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"board"</span><span class="o">)</span>      <span class="c1">// Board 엔티티를 board 테이블과 매핑</span>
<span class="nd">@SecondaryTable</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"board_detail"</span><span class="o">,</span>      <span class="c1">// board_detail 테이블과 추가 매핑</span>
    <span class="n">pkJoinColumns</span> <span class="o">=</span> <span class="nd">@PraimaryKeyJoinColumn</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"board_detail_id"</span><span class="o">))</span>
<span class="cm">/** 두 개 이상 매핑하려면 @SecondaryTables 사용하면 됨
  *
  * @SecondaryTables({
  *     @SecondaryTable(name = "board_detail"),
  *     @SecondaryTable(name = "board_file")})
  */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Board</span> <span class="o">{</span>
    <span class="nd">@Id</span>
    <span class="nd">@GeneratedValue</span>
    <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"board_id"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

    <span class="nd">@Column</span><span class="o">(</span><span class="n">table</span> <span class="o">=</span> <span class="s">"board_detail"</span><span class="o">)</span>     <span class="c1">// board_detail 테이블의 content 컬럼에 매핑</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">content</span><span class="o">;</span>

    <span class="kd">private</span> <span class="nc">String</span> <span class="n">title</span><span class="o">;</span>       <span class="c1">// title 처럼 따로 지정 안해주면 기본 테이블(여기선 board)에 매핑</span>

    <span class="o">...</span>
<span class="o">}</span>
</code></pre></div>    </div>

  </div>
</details>

<ul>
  <li><code class="language-plaintext highlighter-rouge">@SecondaryTable</code> 속성</li>
</ul>

<table>
  <thead>
    <tr>
      <th style="text-align: center">속성</th>
      <th style="text-align: center">설명</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center">name</td>
      <td style="text-align: center">매핑할 다른 테이블의 이름</td>
    </tr>
    <tr>
      <td style="text-align: center">pkJoinColumns</td>
      <td style="text-align: center">매핑할 다른 테이블의 pk 컬럼</td>
    </tr>
  </tbody>
</table>

</article>



<section class="tags">
  <strong>Tags:</strong> <a href="/tag/jpa">jpa</a>,&nbsp;<a href="/tag/relation">relation</a>,&nbsp;<a href="/tag/relationship-mapping">relationship-mapping</a>,&nbsp;<a href="/tag/mapped-superclass">mapped-superclass</a>,&nbsp;<a href="/tag/join">join</a>,&nbsp;<a href="/tag/join-table">join-table</a>,&nbsp;<a href="/tag/inheritance">inheritance</a>,&nbsp;<a href="/tag/discriminator">discriminator</a>
</section>



<section class="rss">
  <p class="rss-subscribe text"><strong>Subscribe <a href="/feed.xml">via RSS</a></strong></p>
</section>

<section class="share">
  <span>Share: </span>
  
    
    
      <a href="//twitter.com/share?text=%5B%EC%9E%90%EB%B0%94+ORM+%ED%91%9C%EC%A4%80+JPA+%ED%94%84%EB%A1%9C%EA%B7%B8%EB%9E%98%EB%B0%8D%5D+7%EC%9E%A5.+%EA%B3%A0%EA%B8%89+%EB%A7%A4%ED%95%91&url=https%3A%2F%2Fsungunjo.github.io%2Fjpa-study%2F2022%2F02%2F05%2Fch.7-advanced-mapping.html&via="
        onclick="window.open(this.href, 'twitter-share', 'width=550,height=255');return false;">
        <i class="fa fa-twitter-square fa-lg"></i>
      </a>
    
    
    
    
    
    
    
  
    
    
    
      <a href="//www.facebook.com/sharer.php?t=%5B%EC%9E%90%EB%B0%94+ORM+%ED%91%9C%EC%A4%80+JPA+%ED%94%84%EB%A1%9C%EA%B7%B8%EB%9E%98%EB%B0%8D%5D+7%EC%9E%A5.+%EA%B3%A0%EA%B8%89+%EB%A7%A4%ED%95%91&u=https%3A%2F%2Fsungunjo.github.io%2Fjpa-study%2F2022%2F02%2F05%2Fch.7-advanced-mapping.html"
        onclick="window.open(this.href, 'facebook-share', 'width=550,height=255');return false;">
        <i class="fa fa-facebook-square fa-lg"></i>
      </a>
    
    
    
    
    
    
  
    
    
    
    
    
    
    
    
  
    
    
    
    
    
      <a href="//www.linkedin.com/shareArticle?mini=true&url=https%3A%2F%2Fsungunjo.github.io%2Fjpa-study%2F2022%2F02%2F05%2Fch.7-advanced-mapping.html"
        onclick="window.open(this.href, 'linkedin-share', 'width=550,height=255');return false;">
        <i class="fa fa-linkedin-square fa-lg"></i>
      </a>
    
    
    
    
  
    
    
    
    
      <a href="//plus.google.com/share?title=%5B%EC%9E%90%EB%B0%94+ORM+%ED%91%9C%EC%A4%80+JPA+%ED%94%84%EB%A1%9C%EA%B7%B8%EB%9E%98%EB%B0%8D%5D+7%EC%9E%A5.+%EA%B3%A0%EA%B8%89+%EB%A7%A4%ED%95%91&url=https%3A%2F%2Fsungunjo.github.io%2Fjpa-study%2F2022%2F02%2F05%2Fch.7-advanced-mapping.html"
        onclick="window.open(this.href, 'google-plus-share', 'width=550,height=255');return false;">
        <i class="fa fa-google-plus-square fa-lg"></i>
      </a>
    
    
    
    
    
  
    
    
    
    
    
    
    
    
  
    
    
    
    
    
    
    
    
  
    
    
    
    
    
    
      <a href="//www.pinterest.com/pin/create/button/?description=%5B%EC%9E%90%EB%B0%94+ORM+%ED%91%9C%EC%A4%80+JPA+%ED%94%84%EB%A1%9C%EA%B7%B8%EB%9E%98%EB%B0%8D%5D+7%EC%9E%A5.+%EA%B3%A0%EA%B8%89+%EB%A7%A4%ED%95%91&url=https%3A%2F%2Fsungunjo.github.io%2Fjpa-study%2F2022%2F02%2F05%2Fch.7-advanced-mapping.html&media=https://sungunjo.github.io/assets/instacode.png"
        onclick="window.open(this.href, 'pinterest-share', 'width=550,height=255');return false;">
        <i class="fa fa-pinterest-square fa-lg"></i>
      </a>
    
    
    
  
    
    
    
    
    
    
    
    
  
    
    
    
    
    
    
    
    
  
    
    
    
    
    
    
    
    
  
    
    
    
    
    
    
    
    
  
    
    
    
    
    
    
    
    
  
    
    
    
    
    
    
    
    
  
    
    
    
    
    
    
    
      <a href="//www.reddit.com/submit" onclick="window.location = '//www.reddit.com/submit?url=' + encodeURIComponent('https://sungunjo.github.io/jpa-study/2022/02/05/ch.7-advanced-mapping.html') + '&title=[자바 ORM 표준 JPA 프로그래밍] 7장. 고급 매핑'; return false">
        <i class="fa fa-reddit-square fa-lg"></i>
      </a>
    
    
  
    
    
    
    
    
    
    
    
  
</section>




<section class="disqus">
  <div id="disqus_thread"></div>
  <script type="text/javascript">
    var disqus_shortname = 'sungunjo-github-io';

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</section>



</div>
</div>

    </div>

    <footer class="site-footer">

  <div class="wrapper">

    <h3 class="footer-heading">Development Stash</h3>

    <div class="site-navigation">

      <p><strong>Site Map</strong></p>
      <ul class="pages">
				
	
	<li class="nav-link"><a href="/about/">About</a>
	

	

	

	
	<li class="nav-link"><a href="/posts/">Posts</a>
	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	


      </ul>
    </div>

    <div class="site-contact">

      <p><strong>Contact</strong></p>
      <ul class="social-media-list">
        <li>
          <a href="mailto:sungunjo.dev@gmail.com">
            <i class="fa fa-envelope-o"></i>
            <span class="username">sungunjo.dev@gmail.com</span>
          </a>
        </li>

        
          
        
          
        
          
          <li>
            <a href="https://github.com/sungunjo" title="Fork me on GitHub">
              <i class="fa fa-github"></i>
              <span class="username">sungunjo</span>
            </a>
          </li>
          
        
          
          <li>
            <a href="https://www.linkedin.com/in/sungunjo" title="Connect with me on LinkedIn">
              <i class="fa fa-linkedin"></i>
              <span class="username">SungUn Jo</span>
            </a>
          </li>
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        

      </ul>
    </div>

    <div class="site-signature">
      <p class="rss-subscribe text"><strong>Subscribe <a href="/feed.xml">via RSS</a></strong></p>
      <p class="text">개발 공부 블로그</p>
    </div>

  </div>

</footer>

<!-- Scripts -->
<script src="//code.jquery.com/jquery-3.4.1.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/highlight.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/lightbox2/2.11.1/js/lightbox.min.js"></script>
<script src="//unpkg.com/popper.js@1"></script>
<script src="//unpkg.com/tippy.js@5"></script>

<script type="text/javascript">
$(document).ready(function() {
  // Default syntax highlighting
  hljs.initHighlightingOnLoad();

  // Header
  var menuToggle = $('#js-mobile-menu').unbind();
  $('#js-navigation-menu').removeClass("show");
  menuToggle.on('click', function(e) {
    e.preventDefault();
    $('#js-navigation-menu').slideToggle(function(){
      if($('#js-navigation-menu').is(':hidden')) {
        $('#js-navigation-menu').removeAttr('style');
      }
    });
  });

	// Enable tooltips via Tippy.js
	if (Array.isArray(window.tooltips)) {
		window.tooltips.forEach(function(tooltip) {
			var selector = tooltip[0];
			var config = tooltip[1];
			tippy(selector, config);
		})
	}
});

</script>




<!-- Google Analytics -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-156645046-1', 'auto');
  ga('send', 'pageview', {
    'page': '/jpa-study/2022/02/05/ch.7-advanced-mapping.html',
    'title': '[자바 ORM 표준 JPA 프로그래밍] 7장. 고급 매핑'
  });
</script>



  </body>

</html>
